import{d as u,g as m,U as f,B as h,h as c,n as g}from"./index-DXwMd8J6.js";import{V as p}from"./VuePlotly-BpPZBeQs.js";import{b as y}from"./LayoutManager-BfjoD8GM.js";import{b}from"./ColorsAndWidths-BxdJmMWj.js";import"./HTTPFileSystem-mhJZeBxO.js";import"./index-6F3aLhar.js";import"./TopSheet-Bo3k3l39.js";import"./papaparse.min-BiqfovEr.js";import"./DashboardDataManager-BPyHyjlN.js";import"./util-DDCxpZ5I.js";import"./fxp-4YEvQr-_.js";import"./extends-CCbyfPlC.js";import"./avro-Dd9UqmeZ.js";import"./RoadNetworkLoader.worker-Dk5IXYzf.js";import"./Coords-D-UV8-Xi.js";import"./group-DobYzF2-.js";import"./index-_doEQLKC.js";import"./color-DZRtpOAM.js";import"./cubehelix-Bg3rkAQA.js";import"./rainbow-Dz4seJAz.js";import"./threshold-DxQAdYxA.js";const x=u({name:"AreaChartPanel",components:{VuePlotly:p},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!0},cardId:String,datamanager:{type:Object,required:!0}},data:()=>({globalState:m.state,dataSet:{},id:"area-"+Math.floor(1e12*Math.random()),colorMap:{},YAMLrequirementsArea:{dataset:"",x:""},data:[],layout:{height:300,margin:{t:8,b:0,l:0,r:0,pad:2},font:{color:"#444444",family:f},xaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:12},animate:!0},yaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:16},animate:!0,showgrid:!1},legend:{orientation:"v",x:1,y:1}},options:{displaylogo:!1,responsive:!0,automargin:!0,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"png",filename:"area-chart",width:null,height:null}}}),async mounted(){this.updateLayout(),this.updateTheme(),this.options.toImageButtonOptions.filename=y(this.cardTitle,this.subfolder),this.dataSet=await this.loadData(),this.updateChart(),this.$emit("dimension-resizer",{id:this.cardId,resizer:this.changeDimensions}),this.$emit("isLoaded")},beforeDestroy(){this.datamanager?.removeFilterListener({...this.config,subfolder:this.subfolder},this.handleFilterChanged)},watch:{"globalState.isDarkMode"(){this.updateTheme()}},methods:{changeDimensions(t){this.layout=Object.assign({},this.layout,t)},updateLayout(){this.layout.xaxis.title.text=this.config.xAxisTitle||this.config.xAxisName||"",this.layout.yaxis.title.text=this.config.yAxisTitle||this.config.yAxisName||""},updateTheme(){const t={paper_bgcolor:h[this.globalState.colorScheme],plot_bgcolor:h[this.globalState.colorScheme],font:{color:this.globalState.isDarkMode?"#cccccc":"#444444"}};this.layout=Object.assign({},this.layout,t)},handleFilterChanged(){if(!this.datamanager)return;const{filteredRows:t}=this.datamanager.getFilteredDataset(this.config);if(!t||!t.length)this.dataSet={allRows:{}};else{const e={},i=Object.keys(t[0]);i.forEach(a=>e[a]={name:a,values:[]}),t.forEach(a=>{i.forEach(s=>e[s].values.push(a[s]))}),this.dataSet={allRows:e}}this.updateChart()},async loadData(){if(!this.datamanager)return{};try{this.validateYAML();let t=await this.datamanager.getDataset(this.config,{subfolder:this.subfolder});if(!this.config.filters)return t;this.datamanager.addFilterListener({...this.config,subfolder:this.subfolder},this.handleFilterChanged);for(const[e,i]of Object.entries(this.config.filters)){const a={dataset:this.config.dataset,column:e,value:i,range:Array.isArray(i)};this.datamanager.setFilter(a)}return{allRows:{}}}catch(t){this.$emit("error",`Error loading: ${this.subfolder}/${this.config.dataset}`),console.error(""+t)}return{allRows:{}}},validateYAML(){for(const t in this.YAMLrequirementsArea)t in this.config||this.$emit("error",{type:c.ERROR,msg:`Area chart missing required key: ${t}`,desc:`Required keys: ${Object.keys(this.YAMLrequirementsArea)}`})},updateChart(){try{this.config.groupBy?this.updateChartWithGroupBy():this.updateChartSimple()}catch(t){const e=""+t;this.$emit("error",{type:c.ERROR,msg:e})}},updateChartWithGroupBy(){},updateChartSimple(){const t=this.dataSet.allRows||{},e=Object.keys(t);let i=!1,a=[];if(!e.length)return;let s=this.config.columns||this.config.usedCol;if(!s&&e.length&&(s=e.filter(o=>o!==this.config.x).sort()),this.colorMap=b(s,this.config.colorRamp),this.config.legendName&&(this.config.legendTitles=this.config.legendName),this.config.legendTitles?.length&&(i=!0),!t[this.config.x]){this.$emit("error",`${this.cardTitle}: "${this.config.dataset}" x column "${this.config.x}" missing`);return}const l={};a=t[this.config.x].values||[],this.config.skipFirstRow&&(a=a.slice(1));for(let o=0;o<s.length;o++){const r=s[o],d=i?this.config.legendTitles[o]??r:r;let n=t[r].values;this.config.skipFirstRow&&(n=n.slice(1)),this.config.convertToSeconds&&(n=this.convertToSeconds(n)),l[r]={name:d,x:a,y:n,stackgroup:"one",mode:"none",marker:{color:this.colorMap[r]}}}this.data=Object.values(l)},convertToSeconds(t){t=t.map(e=>{try{return e.split(":").reduce((s,l)=>parseInt(l,10)+s*60,0)}catch{return 0}})}}});var S=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("VuePlotly",{staticClass:"myplot",attrs:{data:e.data,layout:e.layout,options:e.options,id:e.id}})},v=[],C=g(x,S,v,!1,null,"2eb96e89");const V=C.exports;export{V as default};
