import{l as Q,r as ae,g as ut,R as wt,j as U,M as ni,d as Me,n as Te}from"./index-DXwMd8J6.js";import{W as si}from"./NewXmlFetcher.worker-i6Sbj_zV.js";import{V as ri}from"./VizConfigurator-CptEMdzK.js";import{Z as ai}from"./ZoomButtons-DjT_93U7.js";import{a as Yt,p as Zt,b as Vt,M as Xt,G as Kt,W as li,R as ci,D as ui,S as di}from"./set-rtl-text-plugin-Cr2Q1psc.js";import{G}from"./index-DgdUD6UN.js";import{r as Ie}from"./range-OtVwhkKS.js";import{Q as hi,R as fi,T as gi,U as mi,V as pi,W as vi,c as yi,m as wi,X as bi,Y as Li,p as Ci,Z as Si,_ as xi,$ as Fi,a0 as _i,a1 as Ei,a2 as Oi,a as Di,a3 as Mi,a4 as Ti,a5 as Ii,a6 as Pi}from"./ColorsAndWidths-BxdJmMWj.js";import{c as Ai,w as zi}from"./rainbow-Dz4seJAz.js";import{c as Pe,r as ki}from"./color-DZRtpOAM.js";import{s as Ri,a as Bi}from"./sequential-XEfpT0Cr.js";import{r as Ni,h as qt,k as $i,m as Ae,o as Gi,p as It}from"./cubehelix-Bg3rkAQA.js";import{p as Hi,l as ji,b as Ui}from"./pow-CIR03aoW.js";import{r as Wi,H as Yi}from"./HTTPFileSystem-mhJZeBxO.js";import{m as ze}from"./min-D1slsF82.js";import{r as ke}from"./group-DobYzF2-.js";import{e as Pt}from"./extent-Ccx1MofX.js";import{t as lt,a as k}from"./defaultLocale-VLpijIbO.js";import{s as Zi,b as Vi,a as Xi,t as Ki,c as qi,e as Qi}from"./year-DwdiMAWv.js";import{A as xt}from"./fsum-CWwcR1RF.js";import{C as Ji,S as to,T as eo}from"./text-layer-BIdA0DCN.js";import{D as le}from"./DashboardDataManager-BPyHyjlN.js";import{Y as ce}from"./index-6F3aLhar.js";import{u as io}from"./util-DDCxpZ5I.js";import{C as oo}from"./Coords-D-UV8-Xi.js";import"./lodash-C_sSUKB1.js";import"./index-DXHHUSZh.js";import"./LegendBox-DtHkMABV.js";import"./extends-CCbyfPlC.js";import"./threshold-DxQAdYxA.js";import"./index-_doEQLKC.js";import"./round-D-ROWHlE.js";import"./avro-Dd9UqmeZ.js";import"./RoadNetworkLoader.worker-Dk5IXYzf.js";import"./fxp-4YEvQr-_.js";var Qt={exports:{}};Qt.exports;(function(i){(function(e,t,o){function n(s){var l=this,d=a();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=d(" "),l.s1=d(" "),l.s2=d(" "),l.s0-=d(s),l.s0<0&&(l.s0+=1),l.s1-=d(s),l.s1<0&&(l.s1+=1),l.s2-=d(s),l.s2<0&&(l.s2+=1),d=null}function r(s,l){return l.c=s.c,l.s0=s.s0,l.s1=s.s1,l.s2=s.s2,l}function c(s,l){var d=new n(s),u=l&&l.state,h=d.next;return h.int32=function(){return d.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,u&&(typeof u=="object"&&r(u,d),h.state=function(){return r(d,{})}),h}function a(){var s=4022871197,l=function(d){d=String(d);for(var u=0;u<d.length;u++){s+=d.charCodeAt(u);var h=.02519603282416938*s;s=h>>>0,h-=s,h*=s,s=h>>>0,h-=s,s+=h*4294967296}return(s>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=c:this.alea=c})(Q,i)})(Qt);var no=Qt.exports,Jt={exports:{}};Jt.exports;(function(i){(function(e,t,o){function n(a){var s=this,l="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var u=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^u^u>>>8},a===(a|0)?s.x=a:l+=a;for(var d=0;d<l.length+64;d++)s.x^=l.charCodeAt(d)|0,s.next()}function r(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s}function c(a,s){var l=new n(a),d=s&&s.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(typeof d=="object"&&r(d,l),u.state=function(){return r(l,{})}),u}t&&t.exports?t.exports=c:this.xor128=c})(Q,i)})(Jt);var so=Jt.exports,te={exports:{}};te.exports;(function(i){(function(e,t,o){function n(a){var s=this,l="";s.next=function(){var u=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(u^u<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,a===(a|0)?s.x=a:l+=a;for(var d=0;d<l.length+64;d++)s.x^=l.charCodeAt(d)|0,d==l.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function r(a,s){return s.x=a.x,s.y=a.y,s.z=a.z,s.w=a.w,s.v=a.v,s.d=a.d,s}function c(a,s){var l=new n(a),d=s&&s.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(typeof d=="object"&&r(d,l),u.state=function(){return r(l,{})}),u}t&&t.exports?t.exports=c:this.xorwow=c})(Q,i)})(te);var ro=te.exports,ee={exports:{}};ee.exports;(function(i){(function(e,t,o){function n(a){var s=this;s.next=function(){var d=s.x,u=s.i,h,f;return h=d[u],h^=h>>>7,f=h^h<<24,h=d[u+1&7],f^=h^h>>>10,h=d[u+3&7],f^=h^h>>>3,h=d[u+4&7],f^=h^h<<7,h=d[u+7&7],h=h^h<<13,f^=h^h<<9,d[u]=f,s.i=u+1&7,f};function l(d,u){var h,f=[];if(u===(u|0))f[0]=u;else for(u=""+u,h=0;h<u.length;++h)f[h&7]=f[h&7]<<15^u.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],d.x=f,d.i=0,h=256;h>0;--h)d.next()}l(s,a)}function r(a,s){return s.x=a.x.slice(),s.i=a.i,s}function c(a,s){a==null&&(a=+new Date);var l=new n(a),d=s&&s.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(d.x&&r(d,l),u.state=function(){return r(l,{})}),u}t&&t.exports?t.exports=c:this.xorshift7=c})(Q,i)})(ee);var ao=ee.exports,ie={exports:{}};ie.exports;(function(i){(function(e,t,o){function n(a){var s=this;s.next=function(){var d=s.w,u=s.X,h=s.i,f,g;return s.w=d=d+1640531527|0,g=u[h+34&127],f=u[h=h+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=u[h]=g^f,s.i=h,g+(d^d>>>16)|0};function l(d,u){var h,f,g,m,p,L=[],x=128;for(u===(u|0)?(f=u,u=null):(u=u+"\0",f=0,x=Math.max(x,u.length)),g=0,m=-32;m<x;++m)u&&(f^=u.charCodeAt((m+32)%u.length)),m===0&&(p=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(p=p+1640531527|0,h=L[m&127]^=f+p,g=h==0?g+1:0);for(g>=128&&(L[(u&&u.length||0)&127]=-1),g=127,m=4*128;m>0;--m)f=L[g+34&127],h=L[g=g+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,L[g]=f^h;d.w=p,d.X=L,d.i=g}l(s,a)}function r(a,s){return s.i=a.i,s.w=a.w,s.X=a.X.slice(),s}function c(a,s){a==null&&(a=+new Date);var l=new n(a),d=s&&s.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(d.X&&r(d,l),u.state=function(){return r(l,{})}),u}t&&t.exports?t.exports=c:this.xor4096=c})(Q,i)})(ie);var lo=ie.exports,oe={exports:{}};oe.exports;(function(i){(function(e,t,o){function n(a){var s=this,l="";s.next=function(){var u=s.b,h=s.c,f=s.d,g=s.a;return u=u<<25^u>>>7^h,h=h-f|0,f=f<<24^f>>>8^g,g=g-u|0,s.b=u=u<<20^u>>>12^h,s.c=h=h-f|0,s.d=f<<16^h>>>16^g,s.a=g-u|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,a===Math.floor(a)?(s.a=a/4294967296|0,s.b=a|0):l+=a;for(var d=0;d<l.length+20;d++)s.b^=l.charCodeAt(d)|0,s.next()}function r(a,s){return s.a=a.a,s.b=a.b,s.c=a.c,s.d=a.d,s}function c(a,s){var l=new n(a),d=s&&s.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var h=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(h+f)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,d&&(typeof d=="object"&&r(d,l),u.state=function(){return r(l,{})}),u}t&&t.exports?t.exports=c:this.tychei=c})(Q,i)})(oe);var co=oe.exports,Re={exports:{}};(function(i){(function(e,t,o){var n=256,r=6,c=52,a="random",s=o.pow(n,r),l=o.pow(2,c),d=l*2,u=n-1,h;function f(y,b,_){var v=[];b=b==!0?{entropy:!0}:b||{};var C=L(p(b.entropy?[y,P(t)]:y??x(),3),v),O=new g(v),T=function(){for(var F=O.g(r),A=s,z=0;F<l;)F=(F+z)*n,A*=n,z=O.g(1);for(;F>=d;)F/=2,A/=2,z>>>=1;return(F+z)/A};return T.int32=function(){return O.g(4)|0},T.quick=function(){return O.g(4)/4294967296},T.double=T,L(P(O.S),t),(b.pass||_||function(F,A,z,B){return B&&(B.S&&m(B,O),F.state=function(){return m(O,{})}),z?(o[a]=F,A):F})(T,C,"global"in b?b.global:this==o,b.state)}function g(y){var b,_=y.length,v=this,C=0,O=v.i=v.j=0,T=v.S=[];for(_||(y=[_++]);C<n;)T[C]=C++;for(C=0;C<n;C++)T[C]=T[O=u&O+y[C%_]+(b=T[C])],T[O]=b;(v.g=function(F){for(var A,z=0,B=v.i,S=v.j,E=v.S;F--;)A=E[B=u&B+1],z=z*n+E[u&(E[B]=E[S=u&S+A])+(E[S]=A)];return v.i=B,v.j=S,z})(n)}function m(y,b){return b.i=y.i,b.j=y.j,b.S=y.S.slice(),b}function p(y,b){var _=[],v=typeof y,C;if(b&&v=="object")for(C in y)try{_.push(p(y[C],b-1))}catch{}return _.length?_:v=="string"?y:y+"\0"}function L(y,b){for(var _=y+"",v,C=0;C<_.length;)b[u&C]=u&(v^=b[u&C]*19)+_.charCodeAt(C++);return P(b)}function x(){try{var y;return h&&(y=h.randomBytes)?y=y(n):(y=new Uint8Array(n),(e.crypto||e.msCrypto).getRandomValues(y)),P(y)}catch{var b=e.navigator,_=b&&b.plugins;return[+new Date,e,_,e.screen,P(t)]}}function P(y){return String.fromCharCode.apply(0,y)}if(L(o.random(),t),i.exports){i.exports=f;try{h=Wi}catch{}}else o["seed"+a]=f})(typeof self<"u"?self:Q,[],Math)})(Re);var uo=Re.exports,ho=no,fo=so,go=ro,mo=ao,po=lo,vo=co,J=uo;J.alea=ho;J.xor128=fo;J.xorwow=go;J.xorshift7=mo;J.xor4096=po;J.tychei=vo;var yo=J;const wo=`#define SHADER_NAME animated-flow-lines-layer-fragment-shader

precision highp float;

uniform float animationTailLength;

varying vec4 vColor;
varying float sourceToTarget;
varying vec2 uv;
                                   
void main(void) {
  geometry.uv = uv;

  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - animationTailLength, 1.0, fract(sourceToTarget)));

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,bo=`#define SHADER_NAME animated-flow-lines-layer-vertex-shader
#define SPEED 0.015
#define NUM_PARTS 5.0

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instancePickable;
attribute float instanceStaggering;

uniform float opacity;
uniform float currentTime;
uniform float thicknessUnit;
    
varying vec4 vColor;
varying float sourceToTarget;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);

  float widthPixels = instanceWidths * thicknessUnit;
  
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  if (instancePickable > 0.5) {
    geometry.pickingColor = instancePickingColors;
  }
  
  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;
  DECKGL_FILTER_COLOR(vColor, geometry);

  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; 
}
`,Lo=[0,132,193,255],Be=1800,Co=20,ue=Be/Co;class bt extends Yt{constructor(e){super(e)}getShaders(){return super.getShaders({vs:bo,fs:wo,modules:[Zt,Vt],shaderCache:this.context.shaderCache})}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:G.DOUBLE,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:G.DOUBLE,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:G.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}getNeedsRedraw(){return!0}updateState({props:e,oldProps:t,changeFlags:o}){var n;if(super.updateState({props:e,oldProps:t,changeFlags:o}),o.extensionsChanged){const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{thicknessUnit:t,animationTailLength:o}=this.props,r=Date.now()/1e3%ue/ue*Be;this.state.model.setUniforms(Object.assign(Object.assign({},e),{thicknessUnit:t*4,animationTailLength:o,currentTime:r})).draw()}_getModel(e){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Xt(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new Kt({drawMode:G.TRIANGLE_STRIP,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}bt.defaultProps={currentTime:0,animationTailLength:.7,getSourcePosition:{type:"accessor",value:i=>[0,0]},getTargetPosition:{type:"accessor",value:i=>[0,0]},getPickable:{type:"accessor",value:i=>1},getStaggering:{type:"accessor",value:(i,{index:e})=>Math.random()},getColor:{type:"accessor",value:Lo},getThickness:{type:"accessor",value:1},thicknessUnit:15*2,parameters:{depthTest:!1}};const So=`#define SHADER_NAME flow-line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  if (vColor.a == 0.0) {
    discard;
  }

  geometry.uv = uv;
  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,xo=`#define SHADER_NAME flow-line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 normals;
attribute vec4 instanceColors;
attribute float instanceThickness;    // 0..0.5
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute vec2 instanceEndpointOffsets;
attribute float instancePickable;

uniform vec4 outlineColor;
uniform float thicknessUnit;
uniform float gap;
uniform float opacity;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;
  
  // Position
  vec4 source_commonspace;    
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);

  // linear interpolation of source & target to pick right coord
  float sourceOrTarget = positions.x;
  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);
  uv = positions.xy;
  geometry.uv = uv;
  if (instancePickable > 0.5) {
    geometry.pickingColor = instancePickingColors;
  }
  
  // set the clamp limits in pixel size 
  float lengthCommon = length(target_commonspace - source_commonspace);    
  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;
  
  vec2 limitedOffsetDistances = clamp(   
    project_pixel_size(positions.yz) * thicknessUnit,
    -lengthCommon*.8, lengthCommon*.8
  );
  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);
  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    positions.x
  );

  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);
  vec2 normalsCommon = project_pixel_size(normals.xy);
  float gapCommon = project_pixel_size(gap);
  vec3 offsetCommon = vec3(
    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );
  
  DECKGL_FILTER_SIZE(offsetCommon, geometry);
  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);
  vec4 offset_commonspace = vec4(offsetCommon, 0.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);
      
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  
  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;
  vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Fo=[0,132,193,255],_o=1,de=[1,0,0,1,2,-3,1,1,-3,1,0,0,1,1,-3,0,1,0,1,0,0,0,1,0,0,0,0];function Eo(i,e){return[-e,2*i,1,2*i,-i,1,i,-i,1,-e,2*i,1,i,-i,1,i,-i,1,-e,2*i,1,i,-i,1,-e,-i,1]}const Oo=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class et extends Yt{constructor(e){super(e)}getShaders(){return super.getShaders({vs:xo,fs:So,modules:[Zt,Vt],shaderCache:this.context.shaderCache})}initializeState(){const{attributeManager:e}=this.state;e.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1,type:G.DOUBLE},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1,type:G.DOUBLE},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:G.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}updateState({props:e,oldProps:t,changeFlags:o}){if(super.updateState({props:e,oldProps:t,changeFlags:o}),o.extensionsChanged){const{gl:n}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{gl:t}=this.context,{outlineColor:o,thicknessUnit:n}=this.props;t.lineWidth(1),this.state.model.setUniforms(Object.assign(Object.assign({},e),{outlineColor:o.map(r=>r/255),thicknessUnit:n*2,gap:.5})).draw()}_getModel(e){let t=[],o=[];const{drawOutline:n,outlineThickness:r}=this.props;if(n){t=t.concat(de);const c=r,a=_o;o=o.concat(Eo(c,a))}return t=t.concat(de),o=o.concat(Oo),new Xt(e,Object.assign(Object.assign({id:this.props.id},this.getShaders()),{geometry:new Kt({drawMode:G.TRIANGLES,attributes:{positions:new Float32Array(t),normals:new Float32Array(o)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}}et.layerName="FlowLinesLayer";et.defaultProps={getSourcePosition:{type:"accessor",value:i=>[0,0]},getTargetPosition:{type:"accessor",value:i=>[0,0]},getColor:{type:"accessor",value:Fo},getThickness:{type:"accessor",value:i=>i.count},getPickable:{type:"accessor",value:i=>1},drawOutline:!0,thicknessUnit:12,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}};const Do=`#define SHADER_NAME flow-circles-layer-fragment-shader
#define SOFT_OUTLINE 0.05
#define EPS 0.05
precision highp float;

uniform vec4 emptyColor;
uniform float outlineEmptyMix;

varying vec4 vColor;
varying vec2 unitPosition;
varying float unitInRadius;
varying float unitOutRadius;

float when_gt(float x, float y) {
  return max(sign(x - y), 0.0);
}

void main(void) {
  geometry.uv = unitPosition;
  float distToCenter = length(unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  // See https://stackoverflow.com/questions/47285778
  vec4 ringColor = mix(
    emptyColor / 255., vColor,
    when_gt(unitInRadius, unitOutRadius)
  );
  vec4 outlineColor = mix(
    mix(vColor, emptyColor / 255., outlineEmptyMix),
    vColor,
    when_gt(unitInRadius, unitOutRadius)
  );
  
  float innerR = min(unitInRadius, unitOutRadius) * (1.0 - SOFT_OUTLINE);
  
  // Inner circle
  float step2 = innerR - 2.0 * EPS; 
  float step3 = innerR - EPS;
  
  // Ring
  float step4 = innerR;
  // float step5 = 1.0 - SOFT_OUTLINE - EPS;
  // float step6 = 1.0 - SOFT_OUTLINE;
  float step5 = 1.0 - 5.0 * EPS;
  float step6 = 1.0;
  
  gl_FragColor = vColor;
  gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step2, step3, distToCenter));
  gl_FragColor = mix(gl_FragColor, ringColor, smoothstep(step3, step4, distToCenter));
  gl_FragColor = mix(gl_FragColor, outlineColor, smoothstep(step5, step6, distToCenter));
  // gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step6, 1.0, distToCenter));
  gl_FragColor.a = vColor.a;
  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Mo=`#define SHADER_NAME flow-circles-layer-vertex-shader
#define radiusScale 100

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceInRadius;
attribute float instanceOutRadius;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform vec4 emptyColor;
uniform float outlineEmptyMix;

varying vec4 vColor;
varying vec2 unitPosition;
varying float unitInRadius;
varying float unitOutRadius;

void main(void) {
  geometry.worldPosition = instancePositions;

  float outerRadiusPixels = max(instanceInRadius, instanceOutRadius);
  unitInRadius = instanceInRadius / outerRadiusPixels; 
  unitOutRadius = instanceOutRadius / outerRadiusPixels; 

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
                                                                                                    
  // Find the center of the point and add the current vertex
  vec3 offset = positions * project_pixel_size(outerRadiusPixels);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
                            
  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ne=[0,0,0,255],To=[255,255,255,255],Io=.4;class ht extends Yt{constructor(e){super(e)}getShaders(){return super.getShaders({vs:Mo,fs:Do,modules:[Zt,Vt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:G.DOUBLE,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceInRadius:{size:1,transition:!0,accessor:"getInRadius",defaultValue:1},instanceOutRadius:{size:1,transition:!0,accessor:"getOutRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:G.UNSIGNED_BYTE,accessor:"getColor",defaultValue:Ne}})}updateState({props:e,oldProps:t,changeFlags:o}){if(super.updateState({props:e,oldProps:t,changeFlags:o}),o.extensionsChanged){const{gl:n}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{emptyColor:t,outlineEmptyMix:o}=this.props;this.state.model.setUniforms(Object.assign(Object.assign({},e),{emptyColor:t,outlineEmptyMix:o})).draw()}_getModel(e){const t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Xt(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new Kt({drawMode:G.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0}))}}ht.layerName="FlowCirclesLayer";ht.defaultProps={getColor:{type:"accessor",value:Ne},emptyColor:{type:"accessor",value:To},outlineEmptyMix:{type:"accessor",value:Io},getPosition:{type:"accessor",value:i=>i.position},getInRadius:{type:"accessor",value:1},getOutRadius:{type:"accessor",value:1},parameters:{depthTest:!1}};function ne(i){const{children:e}=i;return e&&e.length>0}function dt(i){const{zoom:e}=i;return e!==void 0}function Ft(i){return i&&!!i.aggregate}var it;(function(i){i.ALL="ALL",i.INCOMING="INCOMING",i.OUTGOING="OUTGOING",i.BETWEEN="BETWEEN"})(it||(it={}));const Po="#fff",Ao=.4,se="rgba(240,240,240,0.5)",zo=[se,"#137CBD"],ko="rgba(220,220,220,0.5)",Ro=[se,"#f6654e"],Bo=[se,"#00a9cc"],No=[255,255,255,255];function $o(i){return Math.round(i*255)}function he(i,e){const t=Pe(i);if(!t)return console.warn("Invalid color: ",i),`rgba(255, 255, 255, ${e})`;const o=t.rgb();return`rgba(${o.r}, ${o.g}, ${o.b}, ${e})`}function j(i){if(Array.isArray(i))return i;const e=Pe(i);if(!e)return console.warn("Invalid color: ",i),No;const t=e.rgb();return[Math.floor(t.r),Math.floor(t.g),Math.floor(t.b),$o(e.opacity)]}function H(i,e){return i?j(i):typeof e=="string"?j(e):e}const I=i=>i[i.length-1];var At;(function(i){i.primary="#162d3c"})(At||(At={}));const fe=20,tt=i=>Ie(0,fe+1).map(e=>i(e/fe)).reverse(),zt="rgba(240,240,240,0.5)",Go=[zt,At.primary],Ho=["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],jo=["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],$e=["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],Uo=$e,Wo={Blues:I(hi),BluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],BluYl:Ho,BrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],BuGn:I(fi),BuPu:I(gi),Burg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],BurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],Cool:tt(Ai),DarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],Emrld:jo,GnBu:I(mi),Grayish:Go,Greens:I(pi),Greys:I(vi),Inferno:tt(yi),Magenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],Magma:tt(wi),Mint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],Oranges:I(bi),OrRd:I(Li),OrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],Peach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],Plasma:tt(Ci),PinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],PuBu:I(Si),PuBuGn:I(xi),PuRd:I(Fi),Purp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],Purples:I(_i),PurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],RdPu:I(Ei),RedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],Reds:I(Oi),Sunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],SunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],Teal:$e,TealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],Viridis:tt(Di),Warm:tt(zi),YlGn:I(Mi),YlGnBu:I(Ti),YlOrBr:I(Ii),YlOrRd:I(Pi)},Yo="#f52020",Zo="#17a5be",Vo={negative:{flows:{scheme:[zt,Zo]}},positive:{flows:{scheme:[zt,Yo]}},locationAreas:{outline:"rgba(92,112,128,0.5)",normal:"rgba(220,220,220,0.5)"},outlineColor:"rgb(230,233,237)"};function Xo(i){return Ge(!1,i.colorScheme,i.darkMode,i.fadeEnabled,i.fadeOpacityEnabled,i.fadeAmount,i.animationEnabled)}function Ge(i,e,t,o,n,r,c){if(i)return Vo;let a;Array.isArray(e)?a=e:(a=e&&Wo[e]||Uo,t&&(a=a.slice().reverse()));{const s=Ie(0,Math.max(10,a.length)),l=s.length-1,d=Ri(Ni(a)).domain([0,l]);if(!o||r===0)a=s.map((u,h)=>d(h));else{const u=Hi().exponent(1.5).domain([l,0]).range([0,2*r/100]);a=s.map((h,f)=>{const g=d(f),m=u(f);if(g==null||m==null)return"#000";const p=qt(g);return p.l=t?p.l-p.l*m:p.l+(100-p.l)*m,p.c=p.c-p.c*(m/4),n&&(p.opacity=p.opacity*(1-m)),p.toString()})}}return{darkMode:t,flows:{scheme:a},locationCircles:{outgoing:t?"#000":"#fff"},outlineColor:t?"#000":"rgba(255, 255, 255, 0.5)"}}function Ko(i){const e=$i,t=i.length;let o=new Array(t),n=new Array(t),r=new Array(t),c=new Array(t),a,s;for(a=0;a<t;++a)s=ki(i[a]),o[a]=s.r||0,n[a]=s.g||0,r[a]=s.b||0,c[a]=s.opacity||0;return o=e(o),n=e(n),r=e(r),c=e(c),function(l){return s.r=o(l),s.g=n(l),s.b=r(l),s.opacity=c(l),s+""}}function _t(i,e,t){const o=Bi(Ko(e)).exponent(.3333333333333333).domain(i);return n=>j(o(n))}function qo(i,e,t){const o=e?e[0]:0,n=e?e[1]:0;if(He(i)){const c=_t([0,n],i.positive.flows.scheme),a=_t([0,o],i.negative.flows.scheme);return s=>s>=0?c(s):a(s)}const r=_t([0,n||0],i.flows.scheme);return c=>r(c)}function Qo(i){return i.positive!==void 0}function He(i){return i.positive!==void 0}function Jo(i,e){const t=i&&i.normal||ko,o=qt(t),n=j(t);return{normal:n,connected:H(i&&i.connected,n),highlighted:H(i&&i.highlighted,he(o[e?"brighter":"darker"](1).toString(),.5)),selected:H(i&&i.selected,he(o[e?"brighter":"darker"](2).toString(),.8)),outline:H(i&&i.outline,j(o[e?"brighter":"darker"](4).toString()))}}function kt(i,e,t){var o,n,r;const c=i&&i.flows&&i.flows.scheme||e,a=qt(c[c.length-1]),s=H(i&&i.flows&&i.flows.highlighted,j(a[t?"brighter":"darker"](.7).toString())),l=H((o=i?.locationCircles)===null||o===void 0?void 0:o.empty,t?"#000":"#fff"),d=H(i&&i.locationCircles&&i.locationCircles.inner,a.toString());return{flows:{scheme:c,highlighted:s},locationCircles:{inner:d,outgoing:H(i&&i.locationCircles&&i.locationCircles.outgoing,t?"#000":"#fff"),incoming:H(i&&i.locationCircles&&i.locationCircles.incoming,a[t?"brighter":"darker"](1.25).toString()),highlighted:H(i&&i.locationCircles&&i.locationCircles.highlighted,s),empty:l,outlineEmptyMix:(r=(n=i?.locationCircles)===null||n===void 0?void 0:n.outlineEmptyMix)!==null&&r!==void 0?r:.4}}}function je(i){const e=!!(i&&i.darkMode);return{darkMode:e,locationAreas:Jo(i&&i.locationAreas,e),outlineColor:j(i&&i.outlineColor||Po),dimmedOpacity:i&&i.dimmedOpacity!=null?i.dimmedOpacity:Ao}}function tn(i){const e=je(i);return Object.assign(Object.assign({},e),kt(i,zo,e.darkMode))}function en(i){const e=je(i);return Object.assign(Object.assign({},e),{positive:kt(i&&i.positive,Ro,e.darkMode),negative:kt(i&&i.negative,Bo,e.darkMode)})}function Rt(i,e,t,o,n,r){if(n-o<=t)return;const c=o+n>>1;Ue(i,e,c,o,n,r%2),Rt(i,e,t,o,c-1,r+1),Rt(i,e,t,c+1,n,r+1)}function Ue(i,e,t,o,n,r){for(;n>o;){if(n-o>600){const l=n-o+1,d=t-o+1,u=Math.log(l),h=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*h*(l-h)/l)*(d-l/2<0?-1:1),g=Math.max(o,Math.floor(t-d*h/l+f)),m=Math.min(n,Math.floor(t+(l-d)*h/l+f));Ue(i,e,t,g,m,r)}const c=e[2*t+r];let a=o,s=n;for(ct(i,e,o,t),e[2*n+r]>c&&ct(i,e,o,n);a<s;){for(ct(i,e,a,s),a++,s--;e[2*a+r]<c;)a++;for(;e[2*s+r]>c;)s--}e[2*o+r]===c?ct(i,e,o,s):(s++,ct(i,e,s,n)),s<=t&&(o=s+1),t<=s&&(n=s-1)}}function ct(i,e,t,o){Et(i,t,o),Et(e,2*t,2*o),Et(e,2*t+1,2*o+1)}function Et(i,e,t){const o=i[e];i[e]=i[t],i[t]=o}function on(i,e,t,o,n,r,c){const a=[0,i.length-1,0],s=[];let l,d;for(;a.length;){const u=a.pop(),h=a.pop(),f=a.pop();if(h-f<=c){for(let p=f;p<=h;p++)l=e[2*p],d=e[2*p+1],l>=t&&l<=n&&d>=o&&d<=r&&s.push(i[p]);continue}const g=Math.floor((f+h)/2);l=e[2*g],d=e[2*g+1],l>=t&&l<=n&&d>=o&&d<=r&&s.push(i[g]);const m=(u+1)%2;(u===0?t<=l:o<=d)&&(a.push(f),a.push(g-1),a.push(m)),(u===0?n>=l:r>=d)&&(a.push(g+1),a.push(h),a.push(m))}return s}function nn(i,e,t,o,n,r){const c=[0,i.length-1,0],a=[],s=n*n;for(;c.length;){const l=c.pop(),d=c.pop(),u=c.pop();if(d-u<=r){for(let p=u;p<=d;p++)ge(e[2*p],e[2*p+1],t,o)<=s&&a.push(i[p]);continue}const h=Math.floor((u+d)/2),f=e[2*h],g=e[2*h+1];ge(f,g,t,o)<=s&&a.push(i[h]);const m=(l+1)%2;(l===0?t-n<=f:o-n<=g)&&(c.push(u),c.push(h-1),c.push(m)),(l===0?t+n>=f:o+n>=g)&&(c.push(h+1),c.push(d),c.push(m))}return a}function ge(i,e,t,o){const n=i-t,r=e-o;return n*n+r*r}const sn=i=>i[0],rn=i=>i[1];class Bt{constructor(e,t=sn,o=rn,n=64,r=Float64Array){this.nodeSize=n,this.points=e;const c=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new c(e.length),s=this.coords=new r(e.length*2);for(let l=0;l<e.length;l++)a[l]=l,s[2*l]=t(e[l]),s[2*l+1]=o(e[l]);Rt(a,s,n,0,a.length-1,0)}range(e,t,o,n){return on(this.ids,this.coords,e,t,o,n,this.nodeSize)}within(e,t,o){return nn(this.ids,this.coords,e,t,o,this.nodeSize)}}var Lt="NOT_FOUND";function an(i){var e;return{get:function(o){return e&&i(e.key,o)?e.value:Lt},put:function(o,n){e={key:o,value:n}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function ln(i,e){var t=[];function o(a){var s=t.findIndex(function(d){return e(a,d.key)});if(s>-1){var l=t[s];return s>0&&(t.splice(s,1),t.unshift(l)),l.value}return Lt}function n(a,s){o(a)===Lt&&(t.unshift({key:a,value:s}),t.length>i&&t.pop())}function r(){return t}function c(){t=[]}return{get:o,put:n,getEntries:r,clear:c}}var cn=function(e,t){return e===t};function un(i){return function(t,o){if(t===null||o===null||t.length!==o.length)return!1;for(var n=t.length,r=0;r<n;r++)if(!i(t[r],o[r]))return!1;return!0}}function We(i,e){var t=typeof e=="object"?e:{equalityCheck:e},o=t.equalityCheck,n=o===void 0?cn:o,r=t.maxSize,c=r===void 0?1:r,a=t.resultEqualityCheck,s=un(n),l=c===1?an(s):ln(c,s);function d(){var u=l.get(arguments);if(u===Lt){if(u=i.apply(null,arguments),a){var h=l.getEntries(),f=h.find(function(g){return a(g.value,u)});f&&(u=f.value)}l.put(arguments,u)}return u}return d.clearCache=function(){return l.clear()},d}function dn(i){var e=Array.isArray(i[0])?i[0]:i;if(!e.every(function(o){return typeof o=="function"})){var t=e.map(function(o){return typeof o=="function"?"function "+(o.name||"unnamed")+"()":typeof o}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function Ye(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];var n=function(){for(var c=arguments.length,a=new Array(c),s=0;s<c;s++)a[s]=arguments[s];var l=0,d,u={memoizeOptions:void 0},h=a.pop();if(typeof h=="object"&&(u=h,h=a.pop()),typeof h!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof h+"]");var f=u,g=f.memoizeOptions,m=g===void 0?t:g,p=Array.isArray(m)?m:[m],L=dn(a),x=i.apply(void 0,[function(){return l++,h.apply(null,arguments)}].concat(p)),P=i(function(){for(var b=[],_=L.length,v=0;v<_;v++)b.push(L[v].apply(null,arguments));return d=x.apply(null,b),d});return Object.assign(P,{resultFunc:h,memoizedResultFunc:x,dependencies:L,lastResult:function(){return d},recomputations:function(){return l},resetRecomputations:function(){return l=0}}),P};return n}var w=Ye(We);const hn={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:(i,e)=>{},makeClusterId:i=>`{[${i}]}`};function fn(i){const{index:e}=i;return e!=null}function Ze(i){const{id:e}=i;return e!=null}function gn(i,e,t,o){const{getLocationLon:n,getLocationLat:r,getLocationId:c}=e,a=Object.assign(Object.assign({},hn),o),{minZoom:s,maxZoom:l,nodeSize:d,makeClusterName:u,makeClusterId:h}=a,f=new Array(l+1);let g=new Array,m=0;for(const v of i){const C=n(v),O=r(v);g.push({x:wn(C),y:bn(O),weight:t(c(v)),zoom:1/0,index:m,parentId:-1,location:v}),m++}f[l+1]=new Bt(g,me,pe,d,Float32Array);let p=l+1;for(let v=l;v>=s;v--){const C=pn(g,v,f[p],a);C.length===g.length?(f[v]=f[p],f[p]=void 0,p=v,g=C):(p=v,g=C,f[v]=new Bt(g,me,pe,d,Float32Array))}if(f.length===0)return[];const L=f.map(v=>v?.points.length),x=ze(L.filter(v=>v>0)),P=Ln(i,e);let y=L.indexOf(P);P<m&&(y++,y<l+1&&(f[y]=f[l+1],f[l+1]=void 0));const b=Math.min(y,L.lastIndexOf(x)),_=new Array;p=NaN;for(let v=y;v>=b;v--){let C;const O=f[v];if(!O)continue;v<y&&(C=ke(f[p].points,F=>F.map(A=>A.id?h(A.id):c(A.location)),F=>F.parentId));const T=[];for(const F of O.points){const{x:A,y:z,numPoints:B,location:S}=F;if(fn(F))T.push({id:c(S),zoom:v,lat:r(S),lon:n(S)});else if(Ze(F)){const{id:E}=F,at=C&&C.get(E);if(!at)throw new Error(`Cluster ${E} doesn't have children`);T.push({id:h(E),name:u(E,B),zoom:v,lat:yn(z),lon:vn(A),children:at})}}_.push({zoom:v,nodes:T}),p=v}return _}function mn(i,e,t,o,n){return{x:i,y:e,zoom:1/0,id:t,parentId:-1,numPoints:o,weight:n}}function pn(i,e,t,o){const n=[],{radius:r,extent:c}=o,a=r/(c*Math.pow(2,e));for(let s=0;s<i.length;s++){const l=i[s];if(l.zoom<=e)continue;l.zoom=e;const d=t.within(l.x,l.y,a);let u=l.weight||1,h=Ze(l)?l.numPoints:1,f=l.x*u,g=l.y*u;const m=(s<<5)+(e+1);for(const p of d){const L=t.points[p];if(L.zoom<=e)continue;L.zoom=e;const x=L.weight||1,P=L.numPoints||1;f+=L.x*x,g+=L.y*x,u+=x,h+=P,L.parentId=m}h===1?n.push(l):(l.parentId=m,n.push(mn(f/u,g/u,m,h,u)))}return n}function vn(i){return(i-.5)*360}function yn(i){const e=(180-i*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function wn(i){return i/360+.5}function bn(i){const e=Math.sin(i*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function me(i){return i.x}function pe(i){return i.y}function Ln(i,e){const{getLocationLon:t,getLocationLat:o}=e,n=new Map;let r=0;for(const a of i){const s=t(a),l=o(a),d=`${s},${l}`,u=n.get(d);n.set(d,u?u+1:1),r++}let c=0;for(const[a,s]of n)s>1&&c++;return r-c}function Cn(i){const e=new Map,t=new Map,o=new Map;for(const{zoom:u,nodes:h}of i){e.set(u,h);for(const f of h)if(ne(f))t.set(f.id,f);else{const{id:g}=f,m=o.get(g);(m==null||m>u)&&o.set(g,u)}}const[n,r]=Pt(i,u=>u.zoom);if(n==null||r==null)throw new Error("Could not determine minZoom or maxZoom");const c=new Map;for(const u of t.values()){const{zoom:h}=u;let f=c.get(h);f||(f=new Map,c.set(h,f)),a(u,g=>{f?.set(g,u)})}function a(u,h){for(const f of u.children){const g=t.get(f);g?a(g,h):h(f)}}const s=(u,h=r)=>{const f=[],g=(m,p)=>{if(h>m.zoom)for(const L of m.children){const x=t.get(L);x?g(x,p):p.push(L)}else p.push(m.id)};return g(u,f),f};function l(u,h){const f=c.get(h);if(!f)return;const g=f.get(u);return g?g.id:void 0}return{availableZoomLevels:i.map(u=>+u.zoom).sort((u,h)=>Ae(u,h)),getClusterNodesFor:u=>{if(u!==void 0)return e.get(u)},getClusterById:u=>t.get(u),getMinZoomForLocation:u=>o.get(u)||n,expandCluster:s,findClusterFor:l,aggregateFlows:(u,h,{getFlowOriginId:f,getFlowDestId:g,getFlowMagnitude:m},p={})=>{if(h>r)return u;const L=[],x=new Map,P=(b,_)=>`${b}:${_}`,{flowCountsMapReduce:y={map:m,reduce:(b,_)=>(b||0)+_}}=p;for(const b of u){const _=f(b),v=g(b),C=l(_,h)||_,O=l(v,h)||v,T=P(C,O);if(C===_&&O===v)L.push(b);else{let F=x.get(T);F?F.count=y.reduce(F.count,y.map(b)):(F={origin:C,dest:O,count:y.map(b),aggregate:!0},L.push(F),x.set(T,F))}}return L}}}function Sn(i,{getFlowOriginId:e,getFlowDestId:t,getFlowMagnitude:o}){const n={incoming:new Map,outgoing:new Map};for(const r of i){const c=e(r),a=t(r),s=o(r);n.incoming.set(a,(n.incoming.get(a)||0)+s),n.outgoing.set(c,(n.outgoing.get(c)||0)+s)}return r=>Math.max(Math.abs(n.incoming.get(r)||0),Math.abs(n.outgoing.get(r)||0))}function xn(i,e){if(!i.length)throw new Error("No available zoom levels");return i[Math.min(Gi(i,Math.floor(e)),i.length-1)]}class Nt{constructor(e){this.getLocationId=t=>dt(t)?t.id:this.accessors.getLocationId(t),this.getLocationName=t=>{let o;return dt(t)&&ne(t)?o=t.name:this.accessors.getLocationName&&(o=this.accessors.getLocationName(t)),o||(o=`${this.getLocationId(t)}`),o},this.getLocationLat=t=>dt(t)?t.lat:this.accessors.getLocationLat(t),this.getLocationLon=t=>dt(t)?t.lon:this.accessors.getLocationLon(t),this.getFlowOriginId=t=>Ft(t)?t.origin:this.accessors.getFlowOriginId(t),this.getFlowDestId=t=>Ft(t)?t.dest:this.accessors.getFlowDestId(t),this.getFlowMagnitude=t=>Ft(t)?t.count:this.accessors.getFlowMagnitude(t),this.getFlowTime=t=>{const{getFlowTime:o}=this.accessors;return o?o(t):void 0},this.accessors=e}setAccessors(e){this.accessors=e}getFlowmapDataAccessors(){return this.accessors}}const Fn=(i,e=0)=>{const t=e,o=new li(Object.assign(Object.assign({},i),{width:i.width+t*2,height:i.height+t*2})).getBounds();return[o[0][0],o[0][1],o[1][0],o[1][1]]},_n=i=>{if(i)return ji().range([.025,.5]).domain([0,Math.max.apply(null,i.map(e=>Math.abs(e||0)))])};function En(i,e,t,o,n){const{getLocationId:r,getLocationName:c,getLocationClusterName:a}=o,s=l=>{const d=t.get(l);return d?c?c(d):r(d)||l:`"${l}"`};for(const l of e)for(const d of l.nodes)if(ne(d)){const u=i.expandCluster(d);if(u.sort((h,f)=>It(n(h),n(f))),a)d.name=a(u);else{const h=u[0],f=u.length===2?u[1]:void 0;d.name=`"${s(h)}" and ${f?`"${s(f)}"`:`${u.length-1} others`}`}}else d.name=s(d.id)}lt("%Y-%m-%d"),lt("%Y-%m-%d %H:%M"),lt("%Y-%m-%d %H:%M:%S"),lt("%Y"),lt("%Y-%m");var X;(function(i){i.SECOND="SECOND",i.MINUTE="MINUTE",i.HOUR="HOUR",i.DAY="DAY",i.MONTH="MONTH",i.YEAR="YEAR"})(X||(X={}));k(".%L");const On=k(":%S"),Dn=k("%I:%M"),Mn=k("%I %p"),Tn=k("%a %d");k("%b %d");const In=k("%b"),Pn=k("%Y"),ft=[{order:0,key:X.SECOND,interval:Zi,format:On,formatFull:k("%Y-%m-%d %H:%M:%S")},{order:1,key:X.MINUTE,interval:Vi,format:Dn,formatFull:k("%Y-%m-%d %H:%M")},{order:2,key:X.HOUR,interval:Xi,format:Mn,formatFull:k("%a %d %b %Y, %I %p")},{order:3,key:X.DAY,interval:Ki,format:Tn,formatFull:k("%a %d %b %Y")},{order:4,key:X.MONTH,interval:qi,format:In,formatFull:k("%b %Y")},{order:5,key:X.YEAR,interval:Qi,format:Pn,formatFull:k("%Y")}];function ve(i){return ft.find(e=>e.key===i)}function An(i){return ft.find(e=>e.order===i)}function zn(i){let e;for(const t of ft){const{interval:o}=t;if(o(i)<i)return e||t;e=t}return ft[ft.length-1]}const kn=20;class Rn{constructor(e){this.getFlowsFromProps=(t,o)=>o.flows,this.getLocationsFromProps=(t,o)=>o.locations,this.getClusterLevelsFromProps=(t,o)=>o.clusterLevels,this.getMaxTopFlowsDisplayNum=(t,o)=>t.settings.maxTopFlowsDisplayNum,this.getSelectedLocations=(t,o)=>{var n;return(n=t.filter)===null||n===void 0?void 0:n.selectedLocations},this.getLocationFilterMode=(t,o)=>{var n;return(n=t.filter)===null||n===void 0?void 0:n.locationFilterMode},this.getClusteringEnabled=(t,o)=>t.settings.clusteringEnabled,this.getLocationTotalsEnabled=(t,o)=>t.settings.locationTotalsEnabled,this.getLocationLabelsEnabled=(t,o)=>t.settings.locationLabelsEnabled,this.getZoom=(t,o)=>t.viewport.zoom,this.getViewport=(t,o)=>t.viewport,this.getSelectedTimeRange=(t,o)=>{var n;return(n=t.filter)===null||n===void 0?void 0:n.selectedTimeRange},this.getColorScheme=(t,o)=>t.settings.colorScheme,this.getDarkMode=(t,o)=>t.settings.darkMode,this.getFadeEnabled=(t,o)=>t.settings.fadeEnabled,this.getFadeOpacityEnabled=(t,o)=>t.settings.fadeOpacityEnabled,this.getFadeAmount=(t,o)=>t.settings.fadeAmount,this.getAnimate=(t,o)=>t.settings.animationEnabled,this.getInvalidLocationIds=w(this.getLocationsFromProps,t=>{if(!t)return;const o=[];for(const n of t){const r=this.accessors.getLocationId(n),c=this.accessors.getLocationLon(n),a=this.accessors.getLocationLat(n);(!(-90<=a&&a<=90)||!(-180<=c&&c<=180))&&o.push(r)}return o.length>0?o:void 0}),this.getLocations=w(this.getLocationsFromProps,this.getInvalidLocationIds,(t,o)=>{if(!t)return;if(!o||o.length===0)return t;const n=new Set(o),r=[];for(const c of t){const a=this.accessors.getLocationId(c);n.has(a)||r.push(c)}return r}),this.getLocationIds=w(this.getLocations,t=>{if(!t)return;const o=new Set;for(const n of t)o.add(this.accessors.getLocationId(n));return o}),this.getSelectedLocationsSet=w(this.getSelectedLocations,t=>t&&t.length>0?new Set(t):void 0),this.getSortedFlowsForKnownLocations=w(this.getFlowsFromProps,this.getLocationIds,(t,o)=>{if(!o||!t)return;const n=[];for(const r of t){const c=this.accessors.getFlowOriginId(r),a=this.accessors.getFlowDestId(r);o.has(c)&&o.has(a)&&n.push(r)}return n.sort((r,c)=>It(Math.abs(this.accessors.getFlowMagnitude(r)),Math.abs(this.accessors.getFlowMagnitude(c))))}),this.getActualTimeExtent=w(this.getSortedFlowsForKnownLocations,t=>{if(!t)return;let o=null,n=null;for(const r of t){const c=this.accessors.getFlowTime(r);c&&((o==null||o>c)&&(o=c),(n==null||n<c)&&(n=c))}if(!(!o||!n))return[o,n]}),this.getTimeGranularityKey=w(this.getSortedFlowsForKnownLocations,this.getActualTimeExtent,(t,o)=>{if(!t||!o)return;const n=ze(t,c=>{const a=this.accessors.getFlowTime(c);return a?zn(a).order:null});if(n==null)return;const r=An(n);return r?r.key:void 0}),this.getTimeExtent=w(this.getActualTimeExtent,this.getTimeGranularityKey,(t,o)=>{const n=o?ve(o):void 0;if(!t||!n?.interval)return;const{interval:r}=n;return[t[0],r.offset(r.floor(t[1]),1)]}),this.getSortedFlowsForKnownLocationsFilteredByTime=w(this.getSortedFlowsForKnownLocations,this.getTimeExtent,this.getSelectedTimeRange,(t,o,n)=>{if(t)return!o||!n||o[0]===n[0]&&o[1]===n[1]?t:t.filter(r=>{const c=this.accessors.getFlowTime(r);return c&&n[0]<=c&&c<n[1]})}),this.getLocationsHavingFlows=w(this.getSortedFlowsForKnownLocations,this.getLocations,(t,o)=>{if(!o||!t)return o;const n=new Set;for(const c of t)n.add(this.accessors.getFlowOriginId(c)),n.add(this.accessors.getFlowDestId(c));const r=[];for(const c of o)n.has(this.accessors.getLocationId(c))&&r.push(c);return r}),this.getLocationsById=w(this.getLocationsHavingFlows,t=>{if(!t)return;const o=new Map;for(const n of t)o.set(this.accessors.getLocationId(n),n);return o}),this.getLocationWeightGetter=w(this.getSortedFlowsForKnownLocations,t=>t?Sn(t,this.accessors.getFlowmapDataAccessors()):void 0),this.getClusterLevels=w(this.getClusterLevelsFromProps,this.getLocationsHavingFlows,this.getLocationWeightGetter,(t,o,n)=>t||(!o||!n?void 0:gn(o,this.accessors.getFlowmapDataAccessors(),n,{maxZoom:kn}))),this.getClusterIndex=w(this.getLocationsById,this.getLocationWeightGetter,this.getClusterLevels,(t,o,n)=>{if(!t||!o||!n)return;const r=Cn(n);return En(r,n,t,this.accessors.getFlowmapDataAccessors(),o),r}),this.getAvailableClusterZoomLevels=w(this.getClusterIndex,this.getSelectedLocations,(t,o)=>{if(!t)return;let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const c=a=>{const s=t.getClusterById(a);if(s)r=Math.max(r,s.zoom),n=Math.min(n,s.zoom);else{const l=t.getMinZoomForLocation(a);r=Math.max(r,l)}};if(o)for(const a of o)c(a);return t.availableZoomLevels.filter(a=>r<=a&&a<=n)}),this._getClusterZoom=w(this.getClusterIndex,this.getZoom,this.getAvailableClusterZoomLevels,(t,o,n)=>!t||!n||o==null?void 0:xn(n,o)),this.getClusterZoom=(t,o)=>{const{settings:n}=t;if(n.clusteringEnabled)return n.clusteringAuto||n.clusteringLevel==null?this._getClusterZoom(t,o):n.clusteringLevel},this.getLocationsForSearchBox=w(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getSelectedLocations,this.getClusterZoom,this.getClusterIndex,(t,o,n,r,c)=>{if(!o)return;let a=Array.from(o);if(c&&n){const s=[];for(const l of n){const d=c.getClusterById(l);d&&!a.find(u=>(dt(u)?u.id:this.accessors.getLocationId(u))===l)&&s.push(d)}s.length>0&&(a=a.concat(s))}return a}),this.getDiffMode=w(this.getFlowsFromProps,t=>{if(t){for(const o of t)if(this.accessors.getFlowMagnitude(o)<0)return!0}return!1}),this._getFlowmapColors=w(this.getDiffMode,this.getColorScheme,this.getDarkMode,this.getFadeEnabled,this.getFadeOpacityEnabled,this.getFadeAmount,this.getAnimate,Ge),this.getFlowmapColorsRGBA=w(this._getFlowmapColors,t=>Qo(t)?en(t):tn(t)),this.getUnknownLocations=w(this.getLocationIds,this.getFlowsFromProps,this.getSortedFlowsForKnownLocations,(t,o,n)=>{if(!t||!o||n)return;const r=new Set;for(const c of o)t.has(this.accessors.getFlowOriginId(c))||r.add(this.accessors.getFlowOriginId(c)),t.has(this.accessors.getFlowDestId(c))||r.add(this.accessors.getFlowDestId(c));return r}),this.getSortedAggregatedFilteredFlows=w(this.getClusterIndex,this.getClusteringEnabled,this.getSortedFlowsForKnownLocationsFilteredByTime,this.getClusterZoom,this.getTimeExtent,(t,o,n,r,c)=>{if(!n)return;let a;return o&&t&&r!=null?a=t.aggregateFlows(n,r,this.accessors.getFlowmapDataAccessors()):a=Bn(n,this.accessors.getFlowmapDataAccessors()),a.sort((s,l)=>It(Math.abs(this.accessors.getFlowMagnitude(s)),Math.abs(this.accessors.getFlowMagnitude(l)))),a}),this.getExpandedSelectedLocationsSet=w(this.getClusteringEnabled,this.getSelectedLocationsSet,this.getClusterIndex,(t,o,n)=>{if(!o||!n)return o;const r=new Set;for(const c of o){const a=n.getClusterById(c);if(a){const s=n.expandCluster(a);for(const l of s)r.add(l)}else r.add(c)}return r}),this.getTotalCountsByTime=w(this.getSortedFlowsForKnownLocations,this.getTimeGranularityKey,this.getTimeExtent,this.getExpandedSelectedLocationsSet,this.getLocationFilterMode,(t,o,n,r,c)=>{const a=o?ve(o):void 0;if(!t||!a||!n)return;const s=t.reduce((l,d)=>{var u;if(this.isFlowInSelection(d,r,c)){const h=a.interval(this.accessors.getFlowTime(d)).getTime();l.set(h,((u=l.get(h))!==null&&u!==void 0?u:0)+this.accessors.getFlowMagnitude(d))}return l},new Map);return Array.from(s.entries()).map(([l,d])=>({time:new Date(l),count:d}))}),this.getMaxLocationCircleSize=w(this.getLocationTotalsEnabled,t=>t?17:1),this.getViewportBoundingBox=w(this.getViewport,this.getMaxLocationCircleSize,Fn),this.getLocationsForZoom=w(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getClusterIndex,this.getClusterZoom,(t,o,n,r)=>t&&n?n.getClusterNodesFor(r):o),this.getLocationTotals=w(this.getLocationsForZoom,this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,o,n,r)=>{if(!o)return;const c=new Map,a=(s,l)=>{var d;const u=(d=c.get(s))!==null&&d!==void 0?d:{incomingCount:0,outgoingCount:0,internalCount:0};return l.incomingCount!=null&&(u.incomingCount+=l.incomingCount),l.outgoingCount!=null&&(u.outgoingCount+=l.outgoingCount),l.internalCount!=null&&(u.internalCount+=l.internalCount),u};for(const s of o)if(this.isFlowInSelection(s,n,r)){const l=this.accessors.getFlowOriginId(s),d=this.accessors.getFlowDestId(s),u=this.accessors.getFlowMagnitude(s);l===d?c.set(l,a(l,{internalCount:u})):(c.set(l,a(l,{outgoingCount:u})),c.set(d,a(d,{incomingCount:u})))}return c}),this.getLocationsTree=w(this.getLocationsForZoom,t=>{if(t)return new Bt(t,o=>Ot(this.accessors.getLocationLon(o)),o=>Dt(this.accessors.getLocationLat(o)))}),this._getLocationIdsInViewport=w(this.getLocationsTree,this.getViewportBoundingBox,(t,o)=>{const n=this._getLocationsInBboxIndices(t,o);if(n)return new Set(n.map(r=>t.points[r].id))}),this.getLocationIdsInViewport=Ye(We,(t,o,n)=>{if(t===o)return!0;if(t==null||o==null||t.size!==o.size)return!1;for(const r of t)if(!o.has(r))return!1;return!0})(this._getLocationIdsInViewport,t=>{if(t)return t}),this.getTotalUnfilteredCount=w(this.getSortedFlowsForKnownLocations,t=>{if(t)return t.reduce((o,n)=>o+this.accessors.getFlowMagnitude(n),0)}),this.getTotalFilteredCount=w(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,o,n)=>t?t.reduce((c,a)=>this.isFlowInSelection(a,o,n)?c+this.accessors.getFlowMagnitude(a):c,0):void 0),this._getLocationTotalsExtent=w(this.getLocationTotals,t=>ye(t,void 0)),this._getLocationTotalsForViewportExtent=w(this.getLocationTotals,this.getLocationIdsInViewport,(t,o)=>ye(t,o)),this.getLocationTotalsExtent=(t,o)=>t.settings.adaptiveScalesEnabled?this._getLocationTotalsForViewportExtent(t,o):this._getLocationTotalsExtent(t,o),this.getFlowsForFlowmapLayer=w(this.getSortedAggregatedFilteredFlows,this.getLocationIdsInViewport,this.getSelectedLocationsSet,this.getLocationFilterMode,this.getMaxTopFlowsDisplayNum,(t,o,n,r,c)=>{if(!t||!o)return;const a=[];let s=0;for(const l of t){const d=this.accessors.getFlowOriginId(l),u=this.accessors.getFlowDestId(l);if((o.has(d)||o.has(u))&&this.isFlowInSelection(l,n,r)&&d!==u&&(a.push(l),s++),s>c)break}return a.reverse()}),this._getFlowMagnitudeExtent=w(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,(t,o,n)=>{if(!t)return;let r;for(const c of t)if(this.accessors.getFlowOriginId(c)!==this.accessors.getFlowDestId(c)&&this.isFlowInSelection(c,o,n)){const a=this.accessors.getFlowMagnitude(c);r==null?r=[a,a]:(a<r[0]&&(r[0]=a),a>r[1]&&(r[1]=a))}return r}),this._getAdaptiveFlowMagnitudeExtent=w(this.getFlowsForFlowmapLayer,t=>{if(!t)return;const o=Pt(t,this.accessors.getFlowMagnitude);return o[0]!==void 0&&o[1]!==void 0?o:void 0}),this.getFlowMagnitudeExtent=(t,o)=>t.settings.adaptiveScalesEnabled?this._getAdaptiveFlowMagnitudeExtent(t,o):this._getFlowMagnitudeExtent(t,o),this.getLocationMaxAbsTotalGetter=w(this.getLocationTotals,t=>o=>{const n=t?.get(o);if(n)return Math.max(Math.abs(n.incomingCount+n.internalCount),Math.abs(n.outgoingCount+n.internalCount))}),this.getFlowThicknessScale=w(this.getFlowMagnitudeExtent,_n),this.getCircleSizeScale=w(this.getMaxLocationCircleSize,this.getLocationTotalsEnabled,this.getLocationTotalsExtent,(t,o,n)=>{if(!o)return()=>t;if(n)return Ui().range([0,t]).domain([0,Math.max.apply(null,n.map(r=>Math.abs(r||0)))])}),this.getInCircleSizeGetter=w(this.getCircleSizeScale,this.getLocationTotals,(t,o)=>n=>{const r=o?.get(n);return r&&t&&t(Math.abs(r.incomingCount+r.internalCount))||0}),this.getOutCircleSizeGetter=w(this.getCircleSizeScale,this.getLocationTotals,(t,o)=>n=>{const r=o?.get(n);return r&&t&&t(Math.abs(r.outgoingCount+r.internalCount))||0}),this.getSortedLocationsForZoom=w(this.getLocationsForZoom,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,(t,o,n)=>t?[...t].sort((c,a)=>{const s=this.accessors.getLocationId(c),l=this.accessors.getLocationId(a);return Ae(Math.max(o(s),n(s)),Math.max(o(l),n(l)))}):void 0),this.getLocationsForFlowmapLayer=w(this.getSortedLocationsForZoom,t=>t),this.getLocationsForFlowmapLayerById=w(this.getLocationsForFlowmapLayer,t=>{if(t)return t.reduce((o,n)=>(o.set(this.accessors.getLocationId(n),n),o),new Map)}),this.getLocationOrClusterByIdGetter=w(this.getClusterIndex,this.getLocationsById,(t,o)=>n=>{var r;return(r=t?.getClusterById(n))!==null&&r!==void 0?r:o?.get(n)}),this.getLayersData=w(this.getLocationsForFlowmapLayer,this.getFlowsForFlowmapLayer,this.getFlowmapColorsRGBA,this.getLocationsForFlowmapLayerById,this.getLocationIdsInViewport,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,this.getFlowThicknessScale,this.getAnimate,this.getLocationLabelsEnabled,(t,o,n,r,c,a,s,l,d,u)=>this._prepareLayersData(t,o,n,r,c,a,s,l,d,u)),this.accessors=new Nt(e),this.setAccessors(e)}setAccessors(e){this.accessors=new Nt(e)}getAggregateAccessors(){return this.accessors}prepareLayersData(e,t){const o=this.getLocationsForFlowmapLayer(e,t)||[],n=this.getFlowsForFlowmapLayer(e,t)||[],r=this.getFlowmapColorsRGBA(e,t),c=this.getLocationsForFlowmapLayerById(e,t),a=this.getLocationIdsInViewport(e,t),s=this.getInCircleSizeGetter(e,t),l=this.getOutCircleSizeGetter(e,t),d=this.getFlowThicknessScale(e,t),u=this.getLocationLabelsEnabled(e,t);return this._prepareLayersData(o,n,r,c,a,s,l,d,e.settings.animationEnabled,u)}_prepareLayersData(e,t,o,n,r,c,a,s,l,d){e||(e=[]),t||(t=[]);const{getFlowOriginId:u,getFlowDestId:h,getFlowMagnitude:f,getLocationId:g,getLocationLon:m,getLocationLat:p,getLocationName:L}=this.accessors,x=Pt(t,S=>f(S)),P=qo(o,x),y=Float32Array.from(function*(){for(const S of e)yield m(S),yield p(S)}()),b=He(o)?o.positive.locationCircles.inner:o.locationCircles.inner,_=Uint8Array.from(function*(){for(const S of e)yield*b}()),v=Float32Array.from(function*(){for(const S of e){const E=g(S);yield r?.has(E)?c(E):1}}()),C=Float32Array.from(function*(){for(const S of e){const E=g(S);yield r?.has(E)?a(E):1}}()),O=Float32Array.from(function*(){for(const S of t){const E=n?.get(u(S));yield E?m(E):0,yield E?p(E):0}}()),T=Float32Array.from(function*(){for(const S of t){const E=n?.get(h(S));yield E?m(E):0,yield E?p(E):0}}()),F=Float32Array.from(function*(){for(const S of t)yield s&&s(f(S))||0}()),A=Float32Array.from(function*(){for(const S of t){const E=u(S),at=h(S);yield Math.max(c(E),a(E)),yield Math.max(c(at),a(at))}}()),z=Uint8Array.from(function*(){for(const S of t)yield*P(f(S))}()),B=l?Float32Array.from(function*(){for(const S of t)yield new yo.alea(`${u(S)}-${h(S)}`)()}()):void 0;return Object.assign({circleAttributes:{length:e.length,attributes:{getPosition:{value:y,size:2},getColor:{value:_,size:4},getInRadius:{value:v,size:1},getOutRadius:{value:C,size:1}}},lineAttributes:{length:t.length,attributes:Object.assign({getSourcePosition:{value:O,size:2},getTargetPosition:{value:T,size:2},getThickness:{value:F,size:1},getColor:{value:z,size:4},getEndpointOffsets:{value:A,size:2}},B?{getStaggering:{value:B,size:1}}:{})}},d?{locationLabels:e.map(L)}:void 0)}getLocationsInBbox(e,t){if(e)return this._getLocationsInBboxIndices(e,t).map(o=>e.points[o])}_getLocationsInBboxIndices(e,t){if(!e)return;const[o,n,r,c]=t,[a,s,l,d]=[Ot(o),Dt(n),Ot(r),Dt(c)];return e.range(Math.min(a,l),Math.min(s,d),Math.max(a,l),Math.max(s,d))}isFlowInSelection(e,t,o){const n=this.accessors.getFlowOriginId(e),r=this.accessors.getFlowDestId(e);if(t)switch(o){case it.ALL:return t.has(n)||t.has(r);case it.BETWEEN:return t.has(n)&&t.has(r);case it.INCOMING:return t.has(r);case it.OUTGOING:return t.has(n)}return!0}}function ye(i,e){if(!i)return;let t;for(const[o,{incomingCount:n,outgoingCount:r,internalCount:c}]of i.entries())if(e==null||e.has(o)){const a=Math.min(n+c,r+c,c),s=Math.max(n+c,r+c,c);t?(a<t[0]&&(t[0]=a),s>t[1]&&(t[1]=s)):t=[a,s]}return t}function Ot(i){return i/360+.5}function Dt(i){const e=Math.sin(i*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Bn(i,e){const t=ke(i,n=>{const r=e.getFlowOriginId(n[0]),c=e.getFlowDestId(n[0]);return{aggregate:!0,origin:r,dest:c,count:n.reduce((s,l)=>{const d=e.getFlowMagnitude(l);return d&&!isNaN(d)&&isFinite(d)?s+d:s},0)}},e.getFlowOriginId,e.getFlowDestId),o=[];for(const n of t.values())for(const r of n.values())o.push(r);return o}function Mt(i,e){const{getInRadius:t,getOutRadius:o}=i.attributes;return Math.max(t.value[e],o.value[e])}function we(i,e){const{getPosition:t}=i.attributes;return[t.value[e*2],t.value[e*2+1]]}function Nn(i,e){const{getColor:t,getEndpointOffsets:o,getSourcePosition:n,getTargetPosition:r,getThickness:c,getStaggering:a}=i.attributes;return{length:1,attributes:Object.assign({getColor:{value:t.value.subarray(e*4,(e+1)*4),size:4},getEndpointOffsets:{value:o.value.subarray(e*2,(e+1)*2),size:2},getSourcePosition:{value:n.value.subarray(e*2,(e+1)*2),size:2},getTargetPosition:{value:r.value.subarray(e*2,(e+1)*2),size:2},getThickness:{value:c.value.subarray(e,e+1),size:1}},a?{getStaggering:{value:a.value.subarray(e,e+1),size:1}}:void 0)}}var $t=1e-6,vt=Math.PI,be=vt/2,Ve=vt/4,Le=vt*2,Tt=180/vt,st=vt/180,re=Math.abs,Xe=Math.atan2,mt=Math.cos,pt=Math.sin,$n=Math.sqrt;function Gn(i){return i>1?be:i<-1?-be:Math.asin(i)}function yt(){}function Ct(i,e){i&&Se.hasOwnProperty(i.type)&&Se[i.type](i,e)}var Ce={Feature:function(i,e){Ct(i.geometry,e)},FeatureCollection:function(i,e){for(var t=i.features,o=-1,n=t.length;++o<n;)Ct(t[o].geometry,e)}},Se={Sphere:function(i,e){e.sphere()},Point:function(i,e){i=i.coordinates,e.point(i[0],i[1],i[2])},MultiPoint:function(i,e){for(var t=i.coordinates,o=-1,n=t.length;++o<n;)i=t[o],e.point(i[0],i[1],i[2])},LineString:function(i,e){Gt(i.coordinates,e,0)},MultiLineString:function(i,e){for(var t=i.coordinates,o=-1,n=t.length;++o<n;)Gt(t[o],e,0)},Polygon:function(i,e){xe(i.coordinates,e)},MultiPolygon:function(i,e){for(var t=i.coordinates,o=-1,n=t.length;++o<n;)xe(t[o],e)},GeometryCollection:function(i,e){for(var t=i.geometries,o=-1,n=t.length;++o<n;)Ct(t[o],e)}};function Gt(i,e,t){var o=-1,n=i.length-t,r;for(e.lineStart();++o<n;)r=i[o],e.point(r[0],r[1],r[2]);e.lineEnd()}function xe(i,e){var t=-1,o=i.length;for(e.polygonStart();++t<o;)Gt(i[t],e,1);e.polygonEnd()}function Hn(i,e){i&&Ce.hasOwnProperty(i.type)?Ce[i.type](i,e):Ct(i,e)}var St=new xt,Fe=new xt,Ke,qe,Ht,jt,Ut,Y={point:yt,lineStart:yt,lineEnd:yt,polygonStart:function(){St=new xt,Y.lineStart=jn,Y.lineEnd=Un},polygonEnd:function(){var i=+St;Fe.add(i<0?Le+i:i),this.lineStart=this.lineEnd=this.point=yt},sphere:function(){Fe.add(Le)}};function jn(){Y.point=Wn}function Un(){Qe(Ke,qe)}function Wn(i,e){Y.point=Qe,Ke=i,qe=e,i*=st,e*=st,Ht=i,jt=mt(e=e/2+Ve),Ut=pt(e)}function Qe(i,e){i*=st,e*=st,e=e/2+Ve;var t=i-Ht,o=t>=0?1:-1,n=o*t,r=mt(e),c=pt(e),a=Ut*c,s=jt*r+a*mt(n),l=a*o*pt(n);St.add(Xe(l,s)),Ht=i,jt=r,Ut=c}function Yn(i){return[Xe(i[1],i[0]),Gn(i[2])]}function Zn(i){var e=i[0],t=i[1],o=mt(t);return[o*mt(e),o*pt(e),pt(t)]}function _e(i,e){return[i[1]*e[2]-i[2]*e[1],i[2]*e[0]-i[0]*e[2],i[0]*e[1]-i[1]*e[0]]}function Vn(i){var e=$n(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]/=e,i[1]/=e,i[2]/=e}var D,R,M,$,q,Je,ti,nt,gt,K,Z,W={point:Wt,lineStart:Ee,lineEnd:Oe,polygonStart:function(){W.point=ii,W.lineStart=Xn,W.lineEnd=Kn,gt=new xt,Y.polygonStart()},polygonEnd:function(){Y.polygonEnd(),W.point=Wt,W.lineStart=Ee,W.lineEnd=Oe,St<0?(D=-(M=180),R=-($=90)):gt>$t?$=90:gt<-$t&&(R=-90),Z[0]=D,Z[1]=M},sphere:function(){D=-(M=180),R=-($=90)}};function Wt(i,e){K.push(Z=[D=i,M=i]),e<R&&(R=e),e>$&&($=e)}function ei(i,e){var t=Zn([i*st,e*st]);if(nt){var o=_e(nt,t),n=[o[1],-o[0],0],r=_e(n,o);Vn(r),r=Yn(r);var c=i-q,a=c>0?1:-1,s=r[0]*Tt*a,l,d=re(c)>180;d^(a*q<s&&s<a*i)?(l=r[1]*Tt,l>$&&($=l)):(s=(s+360)%360-180,d^(a*q<s&&s<a*i)?(l=-r[1]*Tt,l<R&&(R=l)):(e<R&&(R=e),e>$&&($=e))),d?i<q?N(D,i)>N(D,M)&&(M=i):N(i,M)>N(D,M)&&(D=i):M>=D?(i<D&&(D=i),i>M&&(M=i)):i>q?N(D,i)>N(D,M)&&(M=i):N(i,M)>N(D,M)&&(D=i)}else K.push(Z=[D=i,M=i]);e<R&&(R=e),e>$&&($=e),nt=t,q=i}function Ee(){W.point=ei}function Oe(){Z[0]=D,Z[1]=M,W.point=Wt,nt=null}function ii(i,e){if(nt){var t=i-q;gt.add(re(t)>180?t+(t>0?360:-360):t)}else Je=i,ti=e;Y.point(i,e),ei(i,e)}function Xn(){Y.lineStart()}function Kn(){ii(Je,ti),Y.lineEnd(),re(gt)>$t&&(D=-(M=180)),Z[0]=D,Z[1]=M,nt=null}function N(i,e){return(e-=i)<0?e+360:e}function qn(i,e){return i[0]-e[0]}function De(i,e){return i[0]<=i[1]?i[0]<=e&&e<=i[1]:e<i[0]||i[1]<e}function Qn(i){var e,t,o,n,r,c,a;if($=M=-(D=R=1/0),K=[],Hn(i,W),t=K.length){for(K.sort(qn),e=1,o=K[0],r=[o];e<t;++e)n=K[e],De(o,n[0])||De(o,n[1])?(N(o[0],n[1])>N(o[0],o[1])&&(o[1]=n[1]),N(n[0],o[1])>N(o[0],o[1])&&(o[0]=n[0])):r.push(o=n);for(c=-1/0,t=r.length-1,e=0,o=r[t];e<=t;o=n,++e)n=r[e],(a=N(o[1],n[0]))>c&&(c=a,D=n[0],M=o[1])}return K=Z=null,D===1/0||R===1/0?[[NaN,NaN],[NaN,NaN]]:[[D,R],[M,$]]}function Jn(i,e,t){const{pad:o=.05,maxZoom:n=100}=t||{},r=Qn(i),[[c,a],[s,l]]=r,d=o?[[c-o*(s-c),a-o*(l-a)],[s+o*(s-c),l+o*(l-a)]]:r,[u,h]=e;return Object.assign(Object.assign({},ci({width:u,height:h,bounds:d,padding:t?.padding,maxZoom:n})),{width:u,height:h,bearing:0,pitch:0})}function ts(i,e,t,o){const n=c=>({type:"Point",coordinates:e(c)});let r;if(Array.isArray(i))r=i.map(n);else{r=[];for(const c of i)r.push(n(c))}return Jn({type:"GeometryCollection",geometries:r},t,o)}function es(i){return i&&i.locations&&i.flows}function is(i){return i&&typeof i.setFlowmapState=="function"&&typeof i.getViewportForLocations=="function"&&typeof i.getFlowByIndex=="function"&&typeof i.getLocationById=="function"&&typeof i.getLocationByIndex=="function"&&typeof i.getLayersData=="function"}var V=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(c){c(r)})}return new(t||(t=Promise))(function(r,c){function a(d){try{l(o.next(d))}catch(u){c(u)}}function s(d){try{l(o.throw(d))}catch(u){c(u)}}function l(d){d.done?r(d.value):n(d.value).then(a,s)}l((o=o.apply(i,e||[])).next())})};class os{constructor(e){this.selectors=new Rn(e),this.flowmapData=void 0,this.flowmapState=void 0}setAccessors(e){this.selectors.setAccessors(e)}setFlowmapData(e){this.flowmapData=e}getSelectors(){return this.selectors}getFlowmapData(){return this.flowmapData}setFlowmapState(e){return V(this,void 0,void 0,function*(){this.flowmapState=e})}getFlowmapState(){return this.flowmapState}getFlowByIndex(e){return V(this,void 0,void 0,function*(){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData);return t?.[e]})}getLocationByIndex(e){return V(this,void 0,void 0,function*(){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getLocationsForFlowmapLayer(this.flowmapState,this.flowmapData);return t?.[e]})}getLayersData(){return V(this,void 0,void 0,function*(){if(!(!this.flowmapState||!this.flowmapData))return this.selectors.getLayersData(this.flowmapState,this.flowmapData)})}getLocationById(e){return V(this,void 0,void 0,function*(){if(!this.flowmapState||!this.flowmapData)return;const t=this.selectors.getClusterIndex(this.flowmapState,this.flowmapData);if(t){const n=t.getClusterById(e);if(n)return n}const o=this.selectors.getLocationsById(this.flowmapState,this.flowmapData);return o?.get(e)})}getTotalsForLocation(e){var t;return V(this,void 0,void 0,function*(){if(!(!this.flowmapState||!this.flowmapData))return(t=this.selectors.getLocationTotals(this.flowmapState,this.flowmapData))===null||t===void 0?void 0:t.get(e)})}getViewportForLocations(e,t){var o;return V(this,void 0,void 0,function*(){if(!((o=this.flowmapData)===null||o===void 0)&&o.locations)return ts(this.flowmapData.locations,n=>[this.selectors.accessors.getLocationLon(n),this.selectors.accessors.getLocationLat(n)],e,t)})}updateLayersData(e){return V(this,void 0,void 0,function*(){e(yield this.getLayersData())})}getClusterZoom(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterZoom(this.flowmapState,this.flowmapData):void 0}getClusterIndex(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterIndex(this.flowmapState,this.flowmapData):void 0}getLocationsById(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationsById(this.flowmapState,this.flowmapData):void 0}getLocationTotals(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationTotals(this.flowmapState,this.flowmapData):void 0}getFlowsForFlowmapLayer(){return this.flowmapState&&this.flowmapData?this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData):void 0}}var rt;(function(i){i.LOCATION="location",i.FLOW="flow"})(rt||(rt={}));var ns=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(c){c(r)})}return new(t||(t=Promise))(function(r,c){function a(d){try{l(o.next(d))}catch(u){c(u)}}function s(d){try{l(o.throw(d))}catch(u){c(u)}}function l(d){d.done?r(d.value):n(d.value).then(a,s)}l((o=o.apply(i,e||[])).next())})};const ss=["filter","locationTotalsEnabled","locationLabelsEnabled","adaptiveScalesEnabled","animationEnabled","clusteringEnabled","clusteringLevel","fadeEnabled","fadeOpacityEnabled","clusteringAuto","darkMode","fadeAmount","colorScheme","highlightColor","maxTopFlowsDisplayNum"];var ot;(function(i){i.LOCATION="location",i.FLOW="flow"})(ot||(ot={}));class oi extends Ji{constructor(e){super(Object.assign(Object.assign({},e),{onHover:(t,o)=>{const n=Date.now();this.setState({highlightedObject:this._getHighlightedObject(t),lastHoverTime:n});const{onHover:r}=e;r&&this._getFlowmapLayerPickingInfo(t).then(c=>{var a,s;((s=(a=this.state)===null||a===void 0?void 0:a.lastHoverTime)!==null&&s!==void 0?s:0)<=n&&(this.setState({pickingInfo:c}),r(c,o))})},onClick:(t,o)=>{const{onClick:n}=e,r=Date.now();this.setState({lastClickTime:r}),n&&this._getFlowmapLayerPickingInfo(t).then(c=>{var a,s;((s=(a=this.state)===null||a===void 0?void 0:a.lastClickTime)!==null&&s!==void 0?s:0)<=r&&(this.setState({pickingInfo:c}),c&&n(c,o))})}}))}initializeState(){this.state={accessors:new Nt(this.props),dataProvider:this._getOrMakeDataProvider(),layersData:void 0,highlightedObject:void 0,pickingInfo:void 0,lastHoverTime:void 0,lastClickTime:void 0}}getPickingInfo({info:e}){var t,o;if(!e.object){const n=(o=(t=this.state)===null||t===void 0?void 0:t.pickingInfo)===null||o===void 0?void 0:o.object;if(n)return Object.assign(Object.assign({},e),{object:n,picked:!0})}return e}_getOrMakeDataProvider(){const{data:e,dataProvider:t}=this.props;if(is(t))return t;if(es(e)){const o=new os(this.props);return o.setFlowmapData(e),o}throw new Error("FlowmapLayer: data must be a FlowmapDataProvider or FlowmapData")}_updateDataProvider(){this.setState({dataProvider:this._getOrMakeDataProvider()})}shouldUpdateState(e){const{changeFlags:t}=e;return t.viewportChanged?!0:super.shouldUpdateState(e)}updateState({oldProps:e,props:t,changeFlags:o}){if(o.propsChanged,o.dataChanged&&this._updateDataProvider(),(o.viewportChanged||o.dataChanged)&&this.setState({highlightedObject:void 0}),o.viewportChanged||o.dataChanged||o.propsChanged&&ss.some(n=>e[n]!==t[n])){const{dataProvider:n}=this.state||{};n&&(n.setFlowmapState(this._getFlowmapState()),n.updateLayersData(r=>{this.setState({layersData:r,highlightedObject:void 0})},o))}}_getSettingsState(){const{locationTotalsEnabled:e,locationLabelsEnabled:t,adaptiveScalesEnabled:o,animationEnabled:n,clusteringEnabled:r,clusteringLevel:c,fadeEnabled:a,fadeOpacityEnabled:s,clusteringAuto:l,darkMode:d,fadeAmount:u,colorScheme:h,highlightColor:f,maxTopFlowsDisplayNum:g}=this.props;return{locationTotalsEnabled:e,locationLabelsEnabled:t,adaptiveScalesEnabled:o,animationEnabled:n,clusteringEnabled:r,clusteringLevel:c,fadeEnabled:a,fadeOpacityEnabled:s,clusteringAuto:l,darkMode:d,fadeAmount:u,colorScheme:h,highlightColor:f,maxTopFlowsDisplayNum:g}}_getFlowmapState(){return{viewport:rs(this.context.viewport),filter:this.props.filter,settings:this._getSettingsState()}}_getFlowmapLayerPickingInfo(e){var t;return ns(this,void 0,void 0,function*(){const{index:o,sourceLayer:n}=e,{dataProvider:r,accessors:c}=this.state||{};if(!r||!c)return;const a=Object.assign(Object.assign({},e),{picked:e.picked,layer:e.layer,index:e.index,x:e.x,y:e.y,coordinate:e.coordinate,event:e.event});if(n instanceof et||n instanceof bt){const s=o===-1?void 0:yield r.getFlowByIndex(o);if(s){const l=yield r.getLocationById(c.getFlowOriginId(s)),d=yield r.getLocationById(c.getFlowDestId(s));if(l&&d)return Object.assign(Object.assign({},a),{object:{type:rt.FLOW,flow:s,origin:l,dest:d,count:c.getFlowMagnitude(s)}})}}else if(n instanceof ht){const s=o===-1?void 0:yield r.getLocationByIndex(o);if(s){const l=c.getLocationId(s),d=c.getLocationName(s),u=yield r.getTotalsForLocation(l),{circleAttributes:h}=((t=this.state)===null||t===void 0?void 0:t.layersData)||{};if(u&&h){const f=Mt(h,e.index);return Object.assign(Object.assign({},a),{object:{type:rt.LOCATION,location:s,id:l,name:d,totals:u,circleRadius:f}})}}}})}_getHighlightedObject(e){var t,o;const{index:n,sourceLayer:r}=e;if(!(n<0)){if(r instanceof et||r instanceof bt){const{lineAttributes:c}=((t=this.state)===null||t===void 0?void 0:t.layersData)||{};if(c){let a=Nn(c,n);return this.props.fadeOpacityEnabled&&(a=Object.assign(Object.assign({},a),{attributes:Object.assign(Object.assign({},a.attributes),{getColor:Object.assign(Object.assign({},a.attributes.getColor),{value:new Uint8Array([...a.attributes.getColor.value.slice(0,3),255])})})})),{type:ot.FLOW,lineAttributes:a}}}else if(r instanceof ht){const{circleAttributes:c}=((o=this.state)===null||o===void 0?void 0:o.layersData)||{};if(c)return{type:ot.LOCATION,coords:we(c,n),radius:Mt(c,n)}}}}renderLayers(){var e;const t=[];if(!((e=this.state)===null||e===void 0)&&e.layersData){const{layersData:o,highlightedObject:n}=this.state,{circleAttributes:r,lineAttributes:c,locationLabels:a}=o||{};if(r&&c){const s=Xo(this._getSettingsState()),l=j(s.outlineColor||(this.props.darkMode?"#000":"#fff")),d={data:c,parameters:Object.assign(Object.assign({},this.props.parameters),{depthTest:!1})};if(this.props.animationEnabled?t.push(new bt(Object.assign({},this.getSubLayerProps(Object.assign(Object.assign({},d),{id:"animated-flow-lines",drawOutline:!1,thicknessUnit:20}))))):t.push(new et(Object.assign({},this.getSubLayerProps(Object.assign(Object.assign({},d),{id:"flow-lines",drawOutline:!0,outlineColor:l}))))),t.push(new ht(this.getSubLayerProps({id:"circles",data:r,emptyColor:this.props.darkMode?[0,0,0,255]:[255,255,255,255],outlineEmptyMix:.4}))),n)switch(n.type){case ot.LOCATION:t.push(new to(Object.assign({},this.getSubLayerProps({id:"location-highlight",data:[n],pickable:!1,antialiasing:!0,stroked:!0,filled:!1,lineWidthUnits:"pixels",getLineWidth:2,radiusUnits:"pixels",getRadius:u=>u.radius,getLineColor:j(this.props.highlightColor),getPosition:u=>u.coords}))));break;case ot.FLOW:t.push(new et(Object.assign({},this.getSubLayerProps({id:"flow-highlight",data:n.lineAttributes,drawOutline:!0,pickable:!1,outlineColor:j(this.props.highlightColor),outlineThickness:1,parameters:{depthTest:!1}}))));break}}a&&t.push(new eo(this.getSubLayerProps({id:"location-labels",data:a,maxWidth:1e3,pickable:!1,fontFamily:"Helvetica",getPixelOffset:(s,{index:l})=>[0,Mt(r,l)+5],getPosition:(s,{index:l})=>we(r,l),getText:s=>s,getSize:10,getColor:[255,255,255,255],getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"top"})))}return t}}oi.defaultProps={darkMode:!0,fadeAmount:50,locationTotalsEnabled:!0,locationLabelsEnabled:!1,animationEnabled:!1,clusteringEnabled:!0,fadeEnabled:!0,fadeOpacityEnabled:!1,clusteringAuto:!0,clusteringLevel:void 0,adaptiveScalesEnabled:!0,colorScheme:"Teal",highlightColor:"orange",maxTopFlowsDisplayNum:5e3};function rs(i){const{width:e,height:t,longitude:o,latitude:n,zoom:r,pitch:c,bearing:a}=i;return{width:e,height:t,longitude:o,latitude:n,zoom:r,pitch:c,bearing:a}}function as({props:i={},viewId:e=0}){const{locations:t,flows:o,dark:n,elapsed:r,vizDetails:c}=i,[a,s]=ae.useState(ut.state.viewState),[l,d]=ae.useState();wt[e]=()=>{s(ut.state.viewState)};function u(){console.log("click!")}function h(m){s(m),m.center=[m.longitude,m.latitude],ut.commit("setMapCamera",m)}const f=new oi({data:i,id:"my-flowmap-"+e,getLocationId:m=>m.id,getLocationLat:m=>m.lat,getLocationLon:m=>m.lon,getLocationName:m=>m.id,getFlowOriginId:m=>m.o,getFlowDestId:m=>m.d,getFlowMagnitude:m=>m.v||null,adaptiveScalesEnabled:!0,parameters:{depthTest:!1},colorScheme:i.vizDetails.colorScheme,animationEnabled:c.animationEnabled,clusteringEnabled:c.clustering,clusteringAuto:c.clustering,clusteringLevel:c.clusteringLevel,darkMode:n,drawOutline:!1,fadeEnabled:!0,opacity:1,pickable:!0,onHover:m=>d(m)});function g(m){if(!m)return;const{x:p,y:L,object:x}=m;switch(x?.type){case rt.LOCATION:return U.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:p+20,top:L-30}},U.createElement("b",null,x?.type),U.createElement("br",null),"Location ID: ",x?.id);case rt.FLOW:return U.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:p+20,top:L-30}},U.createElement("b",null,x?.type),U.createElement("br",null),"Station IDs: ",x?.origin.id,"  ",x?.dest.id," ",U.createElement("br",null),c.selectedMetric,": ",x?.count)}}return U.createElement(ui,{layers:[f],controller:!0,viewState:a,pickingRadius:4,getCursor:()=>"pointer",onClick:u,onViewStateChange:m=>h(m.viewState)},U.createElement(di,{mapStyle:ut.getters.mapStyle,mapboxApiAccessToken:ni}),g(l))}const ls=Me({name:"TimeSlider",components:{},props:{numHours:Number,hourlyTotals:{type:Object,default:()=>new Float32Array(0)},initial:{type:Array,default:()=>[]},labels:{type:Array,default:()=>[]},isDarkMode:Boolean},data:()=>({leftside:0,rightside:0,isDraggingDivider:0,isDragHappening:!1,dragStartWidth:100,thumbLeft:100,thumbWidth:0,pctStart:0,pctEnd:1,selectedhour:0,maxFlows:1,side:"",activeHour:0,useInitial:!0}),computed:{},watch:{hourlyTotals:function(i,e){this.updateHours(),this.numHours?(this.getWeekHeight(this.numHours),this.activeHour=this.numHours/2):this.activeHour=0,this.showHour(this.activeHour)}},mounted(){this.rightside=this.numHours||0,this.updateHours(),this.numHours?this.activeHour=this.numHours/2:this.activeHour=0,this.showHour(this.activeHour);const e=document.getElementById("hourlybar").clientWidth;this.thumbLeft=Math.floor(this.initial[0]*e),this.thumbWidth=Math.ceil(e);const t=new ResizeObserver(n=>{const c=document.getElementById("hourlybar").clientWidth;let a=this.useInitial?this.initial[0]:this.pctStart;this.useInitial?this.initial[1]:this.pctEnd,this.useInitial=!1,this.thumbLeft=Math.floor(a*c),this.thumbWidth=Math.ceil(c)}),o=document.getElementById("hourlybar");o&&t.observe(o)},methods:{updateHours(){this.maxFlows=Math.max(...this.hourlyTotals.headwayPerHour)},getWeekHeight(i){return Math.max(10,Math.floor(100*i/this.maxFlows))},dividerDragStart(i,e){this.isDraggingDivider=i.clientX,this.dragStartWidth=this.thumbLeft,this.side=e},dividerDragEnd(i){this.isDraggingDivider=0,this.side=""},showHour(i){this.selectedhour=i,this.activeHour=i,this.$emit("hourSelected",this.selectedhour)},dividerDragging(i){if(!this.isDraggingDivider)return;if(this.side=="left")return this.adjustLeftSide(i);if(this.side=="right")return this.adjustRightSide(i);const t=document.getElementById("hourlybar").clientWidth,o=i.clientX-this.isDraggingDivider;this.thumbLeft=Math.max(0,this.dragStartWidth+o),this.thumbLeft=Math.min(this.thumbLeft,t-this.thumbWidth),this.pctStart=this.thumbLeft/t,this.pctEnd=(this.thumbLeft+this.thumbWidth)/t},adjustLeftSide(i){const t=document.getElementById("hourlybar").clientWidth,o=i.clientX-this.isDraggingDivider,n=this.thumbLeft+o;n<0||n>=this.thumbLeft+this.thumbWidth-16||(this.isDraggingDivider+=o,this.thumbLeft+=o,this.thumbWidth-=o,this.thumbLeft=Math.max(0,this.thumbLeft),this.pctStart=this.thumbLeft/t,this.pctEnd=(this.thumbLeft+this.thumbWidth)/t,console.log(this.pctStart,this.pctEnd),this.$emit("range",{start:this.pctStart,end:this.pctEnd}))},adjustRightSide(i){const t=document.getElementById("hourlybar").clientWidth,o=i.clientX-this.isDraggingDivider,n=this.thumbWidth+o;n<16||this.thumbLeft+n>t||(this.thumbWidth+=o,this.isDraggingDivider=i.clientX,this.pctStart=this.thumbLeft/t,this.pctEnd=(this.thumbLeft+this.thumbWidth)/t,this.$emit("range",{start:this.pctStart,end:this.pctEnd}))},sizerDragStart(i){console.log("dragStart",i),this.isDraggingDivider=i.clientX,this.dragStartWidth=this.thumbLeft},sizerDragEnd(i){this.isDraggingDivider=0},sizerDragging(i){if(!this.isDraggingDivider)return;console.log("sizer",this.isDraggingDivider,i.clientX,this.thumbLeft,this.thumbWidth);const t=document.getElementById("hourlybar").clientWidth,o=i.clientX-this.isDraggingDivider;console.log({deltaX:o});let n=o;console.log(n),console.log("oldwidth",this.thumbWidth,"newwidth",this.thumbWidth-n),console.log("oldleft",this.thumbLeft,"newleft",this.thumbLeft+n),this.thumbWidth-=n,this.thumbLeft+=n,this.pctStart=this.thumbLeft/t,this.pctEnd=(this.thumbLeft+this.thumbWidth)/t,this.$emit("range",{start:this.pctStart,end:this.pctEnd})},filterByDate(){}}});var cs=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"time-slider",on:{mousemove:function(o){return o.stopPropagation(),e.dividerDragging.apply(null,arguments)},mouseup:e.dividerDragEnd}},[t("div",{attrs:{id:"hourlybar"}},[t("div",{staticClass:"bars"},e._l(e.hourlyTotals.headwayPerHour,function(o,n){return t("div",{staticClass:"week",style:{height:`${e.getWeekHeight(o)}%`,"background-color":e.activeHour==n?"#7957d5":"#e24986"},on:{click:function(r){return e.showHour(n)}}},[t("div",{staticClass:"weektooltiptext"},[e._v(e._s(n+":00"))])])}),0),e.labels?t("div",{staticClass:"labels"},e._l(e.labels,function(o){return t("div",{staticClass:"date-label",style:{left:`${o.leftPct}%`,right:`${o.rightPct}%`,color:e.isDarkMode?"#C6C1B9":"#363636"}},[e._v(e._s(o.text))])}),0):e._e()])])},us=[],ds=Te(ls,cs,us,!1,null,"e64c46a9");const hs=ds.exports,fs=Me({name:"FlowMap",components:{FlowMapLayer:as,VizConfigurator:ri,ZoomButtons:ai,TimeSlider:hs},props:{config:Object,datamanager:{type:Object},root:{type:String,required:!0},subfolder:{type:String,required:!0},thumbnail:Boolean,yamlConfig:String,configFromDashboard:Object},computed:{fileApi(){return new Yi(this.fileSystem,ut)},fileSystem(){const i=this.$store.state.svnProjects.filter(e=>e.slug===this.root);if(i.length===0)throw console.log("no such project"),Error;return i[0]},mapProps(){return{locations:this.centroids,flows:this.filteredFlows,dark:this.$store.state.isDarkMode,elapsed:this.elapsed,vizDetails:this.vizDetails,slider:this.slider}},urlThumbnail(){return this.thumbnailUrl}},watch:{"$store.state.viewState"(){wt[this.viewId]&&wt[this.viewId]()},"$store.state.isDarkMode"(){this.isDarkMode=this.$store.state.isDarkMode}},data(){return{isLoaded:!1,stopFacilities:{},centroids:[],flows:[],filteredFlows:[],viewId:Math.floor(1e12*Math.random()),statusText:"Loading...",needsInitialMapExtent:!0,myDataManager:this.datamanager||new le(this.root,this.subfolder),thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",resolvers:{},resolverId:0,_roadFetcher:{},startTime:Date.now(),elapsed:0,animator:null,myState:{statusMessage:"",fileApi:void 0,fileSystem:void 0,subfolder:"",thumbnail:!1},crs:"",hourlyTotals:{headwayPerHour:new Float32Array(0)},hours:[],labels:[],numHours:0,selectedHour:0,datasets:[],isDarkMode:this.$store.state.isDarkMode,slider:{map:{},isLoaded:!1,population:[],numInfections:0,coordinates:new Float64Array(1),deckOverlay:{},startDate:"",filterStartHour:0,filterEndHour:24,filteredFlows:[],labels:["",""],csvStreamer:null,useMeters:!0,radiusSlider:250,range:[20,1e3],path:"",updating:!0},vizDetails:{title:"test",description:"",thumbnail:"",zoom:9.5,center:null,pitch:0,bearing:0,stopFacilitiesFile:"",network:"",dataset:"",colorScheme:"Teal",metrics:[{label:"",dataset:"",origin:"",destination:"",flow:"",colorScheme:""}],selectedMetric:"",highlightColor:"orange",fadeEnabled:!0,fadeAmount:50,animationEnabled:!0,clustering:!0,clusteringLevel:null,clusteringEnabled:!0,locationLabelsEnabled:!0,locationTotalsEnabled:!0,pickable:!0,opacity:null,fadeOpacityEnabled:!0,outlineThickness:0,showOnlyTopFlows:null,maxTopFlowsDisplayNum:null}}},async mounted(){try{if(this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myDataManager=this.datamanager||new le(this.root,this.subfolder),this._roadFetcher=new si,await this.getVizDetails(),this.vizDetails.title&&this.$emit("title",this.vizDetails.title),this.thumbnail){this.buildThumbnail();return}this.needsInitialMapExtent&&(this.vizDetails.center||this.vizDetails.zoom)&&(this.$store.commit("setMapCamera",{center:this.vizDetails.center,zoom:this.vizDetails.zoom||9,bearing:this.vizDetails.bearing||0,pitch:this.vizDetails.pitch||0,longitude:this.vizDetails.center?this.vizDetails.center[0]:0,latitude:this.vizDetails.center?this.vizDetails.center[1]:0}),this.needsInitialMapExtent=!1),await this.loadBoundaries(),this.vizDetails=Object.assign({},this.vizDetails),this.vizDetails.selectedMetric=this.vizDetails.metrics[0].flow,this.slider.labels=["test","test"],this.slider=Object.assign({},this.slider),await this.configureData(this.vizDetails.metrics[0]),this.$emit("isLoaded"),this.statusText=""}catch(i){this.$emit("error","Flowmap"+i)}},beforeDestroy(){this._roadFetcher&&this._roadFetcher.terminate(),this.animator&&window.cancelAnimationFrame(this.animator),delete wt[this.viewId]},methods:{async getVizDetails(){if(this.configFromDashboard){console.log("we have a dashboard"),this.validateYAML(),console.log(this.configFromDashboard),this.vizDetails=Object.assign({},this.configFromDashboard);return}new RegExp(".*(yml|yaml)$").test(this.yamlConfig??"")&&(console.log("has yaml"),await this.loadStandaloneYAMLConfig())},async buildThumbnail(){if(this.myState.fileApi&&this.thumbnail&&this.vizDetails.thumbnail)try{const e=await(await this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail)).arrayBuffer(),t=io.arrayBufferToBase64(e);t&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${t})`)}catch(i){console.error(i)}},async validateYAML(){},async handleClickedMetric(i){this.configureData(i)},async loadStandaloneYAMLConfig(){if(!this.fileApi)return{};const i=this.yamlConfig??"",e=i.indexOf("/")>-1?i:this.subfolder+"/"+this.yamlConfig;try{const o=await this.fileApi.getFileText(e);this.vizDetails=Object.assign({},ce.parse(o));return}catch(o){const n=""+o;n.startsWith("YAMLSemantic")&&this.$emit("error",`${e}: ${n}`),console.log(`${e} not found, trying config folders`)}const{vizes:t}=await this.fileApi.findAllYamlConfigs(this.subfolder);if(t[i])try{const o=await this.fileApi.getFileText(t[i]);this.vizDetails=Object.assign({},ce.parse(o))}catch{console.error(`Also failed to load ${t[i]}`)}},fetchXML(i){let e=i.worker;e.onmessage=n=>{const{resolve:r,reject:c}=this.resolvers[n.data.id];e.terminate(),n.data.error&&c(n.data.error),r(n.data.xml)};const t=this.resolverId++;return e.postMessage({id:t,fileSystem:this.fileSystem,filePath:i.filePath,options:i.options}),new Promise((n,r)=>{this.resolvers[t]={resolve:n,reject:r}})},setupHourlyTotals(){this.numHours=this.getMaxHour(),this.slider.filterStartHour=0,this.slider.filterEndHour=this.numHours,this.hourlyTotals={headwayPerHour:new Float32Array(this.numHours+1)},this.flows.forEach(t=>{this.hourlyTotals.headwayPerHour[t.h]+=1});const i="00:00",e=this.numHours+":00";this.labels.push({leftPct:"0",rightPct:"auto",top:"2px",text:i.toString()}),this.labels.push({leftPct:"auto",rightPct:"0",top:"2px",text:e.toString()})},getMaxHour(){return this.flows?this.flows.reduce((i,e)=>e.h>i?e.h:i,this.flows[0].h):0},async loadBoundaries(){let i={};try{const{files:e}=await this.fileApi.getDirectory(this.myState.subfolder),t=e.filter(o=>o.endsWith("transitSchedule.xml.gz")&&!o.startsWith("._"));if(this.stopFacilities=t,!t)console.error("no transit schedule found."),this.vizDetails.stopFacilitiesFile="";else{this.vizDetails.stopFacilitiesFile=t[0];const o=this.fetchXML({worker:this._roadFetcher,slug:this.fileSystem.slug,filePath:this.myState.subfolder+"/"+this.vizDetails.stopFacilitiesFile,options:{attributeNamePrefix:""}});i=await Promise.all([o]),i[0]&&i[0].transitSchedule?this.stopFacilities=i[0].transitSchedule:console.error("fetched xml didn't have transit schedule")}}catch(e){this.$emit("error","Boundaries: "+e),console.error(e);return}this.calculateCentroids(),this.setMapCenter()},filterByHour(i){let e=this.flows.reduce((t,o)=>(o.h==i&&t.push(o),t),[]);this.filteredFlows=e},calculateCentroids(){if(this.stopFacilities!==void 0){this.stopFacilities?.attributes&&this.stopFacilities?.attributes?.attribute?.name==="coordinateReferenceSystem"?(this.crs=this.stopFacilities?.attributes?.attribute?.["#text"],console.log(this.crs)):(console.log("no crs found in transit schedule, reverting to WGS 84"),this.crs="EPSG:4326");for(const i of this.stopFacilities.transitStops.stopFacility){const[e,t]=oo.toLngLat(this.crs,[parseFloat(i.x),parseFloat(i.y)]);this.centroids.push({id:i.id,lon:e,lat:t})}}else console.error("transit schedule from xml is undefined.")},async setMapCenter(){if(this.vizDetails.center){typeof this.vizDetails.center=="string"&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number)),this.$store.commit("setMapCamera",{longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],bearing:0,pitch:0,zoom:this.vizDetails.zoom||10,jump:!1});return}if(!this.centroids.length)return;let i=0,e=0,t=0;const o=this.centroids.length,n=256;for(let c=0;c<o;c+=n)e+=this.centroids[c].lon,t+=this.centroids[c].lat,i++;e=e/i,t=t/i;const r=this.$store.state.viewState;e&&t&&this.$store.commit("setMapCamera",{longitude:e,latitude:t,bearing:r.bearing,pitch:r.pitch,zoom:this.vizDetails.zoom||r.zoom,jump:!1})},async configureData(i){this.vizDetails.colorScheme=i.colorScheme,this.vizDetails.selectedMetric=i.flow;const e=i.origin||"origin",t=i.destination||"destination",o=i.flow||"flow",n="departureHour";try{this.vizDetails.dataset=i.dataset;const c=(await this.myDataManager.getDataset(this.vizDetails,{subfolder:this.subfolder})).allRows||{};e in c||this.$emit("error",`Column ${e} not found`),t in c||this.$emit("error",`Column ${t} not found`),o in c||this.$emit("error",`Column ${o} not found`);const a=c[e].values,s=c[t].values,l=c[o].values,d=c[n].values,u=[];for(let h=0;h<a.length;h++)try{(i.flow.includes("Headway")||i.flow.includes("headway"))&&l[h]?u.push({o:`${a[h]}`,d:`${s[h]}`,v:1/l[h],h:d[h]}):u.push({o:`${a[h]}`,d:`${s[h]}`,v:l[h],h:d[h]})}catch{}this.flows=u,this.filteredFlows=this.flows,this.setupHourlyTotals(),this.isLoaded=!0}catch(r){console.log(""+r),this.flows=[],this.$emit("error",""+r)}}}});var gs=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"flowmap-page"},[t("div",{staticClass:"flowmap",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[t("div",{staticClass:"map-layout"},[e.centroids.length?t("flow-map-layer",{staticClass:"map-layer",attrs:{viewId:e.viewId,props:e.mapProps}}):e._e()],1),e.thumbnail?e._e():t("zoom-buttons"),e.thumbnail?e._e():t("div",{staticClass:"bottom-panel"},[t("h1",[e._v(e._s(`Hours ${e.slider.filterStartHour} - ${e.slider.filterEndHour}`)+" ")]),t("div",{staticClass:"button-row"},[e.isLoaded?t("time-slider",{staticClass:"time-slider",attrs:{numHours:e.numHours,hourlyTotals:e.hourlyTotals,initial:[0,e.getMaxHour()],labels:e.labels,isDarkMode:e.isDarkMode},on:{hourSelected:e.filterByHour}}):e._e()],1)])],1),t("div",{staticClass:"right-side-panel"},[t("div",{staticClass:"metric-label"},[e._v(e._s(e.$t("metrics"))+":")]),t("div",{staticClass:"metric-buttons"},e._l(e.vizDetails.metrics,function(o,n){return t("button",{key:n,staticClass:"button is-small metric-button",style:{color:"white",border:e.isDarkMode?"1px solid white":"1px solid #2A3C4F","border-radius":"4px",backgroundColor:(e.isDarkMode,"#2a3c4f")},on:{click:function(r){return e.handleClickedMetric(o)}}},[e._v(e._s(o.label))])}),0),t("br"),t("div",{staticClass:"metric-label"},[e._v(e._s(e.$t("color scheme"))+":")]),t("b-select",{staticClass:"form-select is-small",attrs:{"aria-labelledby":"lil-gui-name-2"},model:{value:e.vizDetails.colorScheme,callback:function(o){e.$set(e.vizDetails,"colorScheme",o)},expression:"vizDetails.colorScheme"}},[t("option",{attrs:{value:"Blues"}},[e._v("Blues")]),t("option",{attrs:{value:"BluGrn"}},[e._v("BluGrn")]),t("option",{attrs:{value:"BluYl"}},[e._v("BluYl")]),t("option",{attrs:{value:"BrwnYl"}},[e._v("BrwnYl")]),t("option",{attrs:{value:"BuGn"}},[e._v("BuGn")]),t("option",{attrs:{value:"BuPu"}},[e._v("BuPu")]),t("option",{attrs:{value:"Burg"}},[e._v("Burg")]),t("option",{attrs:{value:"BurgYl"}},[e._v("BurgYl")]),t("option",{attrs:{value:"Cool"}},[e._v("Cool")]),t("option",{attrs:{value:"DarkMint"}},[e._v("DarkMint")]),t("option",{attrs:{value:"Emrld"}},[e._v("Emrld")]),t("option",{attrs:{value:"GnBu"}},[e._v("GnBu")]),t("option",{attrs:{value:"Grayish"}},[e._v("Grayish")]),t("option",{attrs:{value:"Greens"}},[e._v("Greens")]),t("option",{attrs:{value:"Greys"}},[e._v("Greys")]),t("option",{attrs:{value:"Inferno"}},[e._v("Inferno")]),t("option",{attrs:{value:"Magenta"}},[e._v("Magenta")]),t("option",{attrs:{value:"Magma"}},[e._v("Magma")]),t("option",{attrs:{value:"Mint"}},[e._v("Mint")]),t("option",{attrs:{value:"Oranges"}},[e._v("Oranges")]),t("option",{attrs:{value:"OrRd"}},[e._v("OrRd")]),t("option",{attrs:{value:"OrYel"}},[e._v("OrYel")]),t("option",{attrs:{value:"Peach"}},[e._v("Peach")]),t("option",{attrs:{value:"Plasma"}},[e._v("Plasma")]),t("option",{attrs:{value:"PinkYl"}},[e._v("PinkYl")]),t("option",{attrs:{value:"PuBu"}},[e._v("PuBu")]),t("option",{attrs:{value:"PuBuGn"}},[e._v("PuBuGn")]),t("option",{attrs:{value:"PuRd"}},[e._v("PuRd")]),t("option",{attrs:{value:"Purp"}},[e._v("Purp")]),t("option",{attrs:{value:"Purples"}},[e._v("Purples")]),t("option",{attrs:{value:"PurpOr"}},[e._v("PurpOr")]),t("option",{attrs:{value:"RdPu"}},[e._v("RdPu")]),t("option",{attrs:{value:"RedOr"}},[e._v("RedOr")]),t("option",{attrs:{value:"Reds"}},[e._v("Reds")]),t("option",{attrs:{value:"Sunset"}},[e._v("Sunset")]),t("option",{attrs:{value:"SunsetDark"}},[e._v("SunsetDark")]),t("option",{attrs:{value:"Teal"}},[e._v("Teal")]),t("option",{attrs:{value:"TealGrn"}},[e._v("TealGrn")]),t("option",{attrs:{value:"Viridis"}},[e._v("Viridis")]),t("option",{attrs:{value:"Warm"}},[e._v("Warm")]),t("option",{attrs:{value:"YlGn"}},[e._v("YlGn")]),t("option",{attrs:{value:"YlGnBu"}},[e._v("YlGnBu")]),t("option",{attrs:{value:"YlOrBr"}},[e._v("YlOrBr")]),t("option",{attrs:{value:"YlOrRd"}},[e._v("YlOrRd")])]),t("br"),t("b-checkbox",{staticClass:"tight",model:{value:e.vizDetails.animationEnabled,callback:function(o){e.$set(e.vizDetails,"animationEnabled",o)},expression:"vizDetails.animationEnabled"}},[t("p",[e._v("Animation")])]),t("br"),t("b-checkbox",{staticClass:"tight",model:{value:e.vizDetails.clustering,callback:function(o){e.$set(e.vizDetails,"clustering",o)},expression:"vizDetails.clustering"}},[t("p",[e._v("Clustering")])])],1)])},ms=[],ps=Te(fs,gs,ms,!1,null,"173454c8");const Qs=ps.exports;export{Qs as default};
