import{d as l,g as r,m as p,C as m,n as c}from"./index-DXwMd8J6.js";const h=l({name:"BackgroundMapOnTop",components:{},data:()=>({containerId:`c${Math.floor(1e12*Math.random())}`,globalState:r.state,isDarkMode:!1,isMapMoving:!1,mapId:`map-${Math.floor(1e12*Math.random())}`,layerId:Math.floor(1e12*Math.random()),mymap:{},resizer:null,isMapReady:!1}),computed:{},methods:{setupResizer(){this.resizer=new ResizeObserver(()=>{this.mymap.resize()});const t=document.getElementById(this.containerId);this.resizer.observe(t)},handleMapMotion(){if(!this.isMapReady)return;const t={longitude:this.mymap.getCenter().lng,latitude:this.mymap.getCenter().lat,bearing:this.mymap.getBearing(),zoom:this.mymap.getZoom(),pitch:this.mymap.getPitch()};this.$store.commit("setMapCamera",t),this.isMapMoving||(this.isMapMoving=!0)},setupMap(){const t=r.state.mapStyles;try{this.mymap=new p.Map({container:this.mapId,style:this.isDarkMode?t.transparentDark:t.transparentLight,logoPosition:"top-left"});const{jump:s,initial:o,startup:e,...i}=this.globalState.viewState;i.center=[i.longitude,i.latitude],this.mymap.jumpTo(i)}catch(s){console.error("HUH?"+s);return}this.mymap.on("load",this.mapIsReady);let a=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact");for(const s of a)s.setAttribute("style","display: none");a=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-group");for(const s of a)s.setAttribute("style","display: none");a=document.getElementsByClassName("mapboxgl-ctrl-logo");for(const s of a)s.setAttribute("style","display: none")},async mapIsReady(){this.isMapReady=!0,this.setupResizer(),this.mymap.on("move",this.handleMapMotion)},viewMoved(t){if(!this.isMapReady)return;if(!this.mymap||this.isMapMoving){this.isMapMoving=!1;return}const{bearing:a,longitude:s,latitude:o,zoom:e,pitch:i}=t;!s||!o||!e||(this.mymap.off("move",this.handleMapMotion),this.mymap.jumpTo({bearing:a,zoom:e,center:[s,o],pitch:i}),this.mymap.on("move",this.handleMapMotion))}},watch:{"globalState.viewState"(t){this.viewMoved(t)},"$store.state.colorScheme"(){if(this.isDarkMode=this.$store.state.colorScheme===m.DarkMode,!this.mymap)return;const t=r.state.mapStyles;this.mymap.setStyle(this.isDarkMode?t.transparentDark:t.transparentLight),this.mymap.on("style.load",()=>{})},"$store.state.resizeEvents"(){this.mymap&&this.mymap.resize()}},beforeDestroy(){this.resizer?.disconnect()},mounted(){this.isDarkMode=this.$store.state.colorScheme===m.DarkMode,this.setupMap()}});var d=function(){var a=this,s=a._self._c;return a._self._setupProxy,s("div",{staticClass:"mymaplibre-map",attrs:{id:a.containerId}},[s("div",{staticClass:"mymap",attrs:{id:a.mapId}})])},g=[],u=c(h,d,g,!1,null,"f469fa8b");const b=u.exports;async function y(t,a){const s=t.context.deck.canvas.toDataURL("image/png"),o=a?.toDataURL("image/png"),e=[];o&&e.push(o),e.push(s);const i=await f({width:t.context.deck.canvas.width,height:t.context.deck.canvas.height,imageDataURLs:e});var n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download","screenshot.png"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function f(t){return new Promise((a,s)=>{var o=document.createElement("canvas");o.width=t.width,o.height=t.height,Promise.all(t.imageDataURLs.map(e=>M(o,e))).then(()=>{const e=o.getContext("2d"),i=o.width-152,n=o.height-8;e.beginPath(),e.rect(i-4,n-14,158,22),e.fillStyle="#ffffff44",e.fill(),e.font="11px Arial",e.fillStyle="#888",e.fillText("© Mapbox  © OpenStreetMap",i,n),a(o.toDataURL("image/png"))})})}function M(t,a){return new Promise((s,o)=>{t||o(),a||o();var e=new Image;e.onload=function(){t.getContext("2d").drawImage(this,0,0),s(!0)},e.src=a})}const x={savePNG:y};export{b as B,x as s};
