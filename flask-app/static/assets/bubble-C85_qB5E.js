import{d,g as c,U as u,B as h,h as f,n as m}from"./index-D5-tbn2z.js";import{V as g}from"./VuePlotly-Di36hnn1.js";import{b as p}from"./LayoutManager-CZQ9MlTy.js";import"./index-BbtBDwfe.js";import"./TopSheet-DEgCii0j.js";import"./papaparse.min-C96aDnBe.js";import"./DashboardDataManager-JgIt0Nd-.js";import"./util-CHADgdP7.js";import"./fxp-4YEvQr-_.js";import"./extends-CCbyfPlC.js";import"./avro-Dd9UqmeZ.js";import"./RoadNetworkLoader.worker-Bt7-RMFX.js";import"./Coords-CQQjH_Bj.js";import"./group-DobYzF2-.js";import"./index-_doEQLKC.js";const b=d({name:"BubbleChartPanel",components:{VuePlotly:g},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!0},datamanager:{type:Object,required:!0},cardId:String},data:()=>({globalState:c.state,dataSet:{},id:"bubble-"+Math.floor(1e12*Math.random()),colorMap:{},layout:{height:300,margin:{t:8,b:0,l:0,r:0,pad:2},font:{color:"#444444",family:u},xaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:12},animate:!0},yaxis:{automargin:!0,autorange:!0,title:{text:"",standoff:16},animate:!0},legend:{orientation:"v",x:1,y:1}},data:[],options:{displaylogo:!1,responsive:!0,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"png",filename:"bubble-chart",width:null,height:null}}}),async mounted(){this.updateTheme(),this.options.toImageButtonOptions.filename=p(this.cardTitle,this.subfolder),this.dataSet=await this.loadData(),this.updateChart(),this.$emit("dimension-resizer",{id:this.cardId,resizer:this.changeDimensions}),this.$emit("isLoaded")},beforeDestroy(){this.datamanager?.removeFilterListener({...this.config,subfolder:this.subfolder},this.handleFilterChanged)},watch:{"globalState.isDarkMode"(){this.updateTheme()}},methods:{changeDimensions(e){this.layout=Object.assign({},this.layout,e)},updateTheme(){const e={paper_bgcolor:h[this.globalState.colorScheme],plot_bgcolor:h[this.globalState.colorScheme],font:{color:this.globalState.isDarkMode?"#cccccc":"#444444"}};this.layout=Object.assign({},this.layout,e)},async loadData(){if(!this.datamanager)return{};try{let e=await this.datamanager.getDataset(this.config,{subfolder:this.subfolder});if(!this.config.filters)return e;this.datamanager.addFilterListener({...this.config,subfolder:this.subfolder},this.handleFilterChanged);for(const[t,i]of Object.entries(this.config.filters)){const a={dataset:this.config.dataset,column:t,value:i,range:Array.isArray(i)};this.datamanager.setFilter(a)}return{allRows:{}}}catch(e){this.$emit("error",`Error loading: ${this.subfolder}/${this.config.dataset}`),console.error(""+e)}return{allRows:{}}},handleFilterChanged(){if(!this.datamanager)return;const{filteredRows:e}=this.datamanager.getFilteredDataset(this.config);if(!e||!e.length)this.dataSet={allRows:{}};else{const t={},i=Object.keys(e[0]);i.forEach(a=>t[a]={name:a,values:[]}),e.forEach(a=>{i.forEach(s=>t[s].values.push(a[s]))}),this.dataSet={allRows:t}}this.updateChart()},updateChart(){this.layout.xaxis.title.text=this.config.xAxisTitle||this.config.xAxisName||"",this.layout.yaxis.title.text=this.config.yAxisTitle||this.config.yAxisName||"";try{this.config.groupBy?this.updateChartWithGroupBy():this.updateChartSimple()}catch(e){const t=""+e;this.$emit("error",{type:f.ERROR,msg:t,desc:"Add a desription..."})}},updateChartWithGroupBy(){},updateChartSimple(){const e=this.config.factor||1;var t=this.config.bubble;this.config.legendName&&(t=this.config.legendName),this.config.legendTitle&&(t=this.config.legendTitle);const i=this.dataSet.allRows||{};if(Object.keys(i).length===0)return;let a=!0;const s=["x","y","bubble"];for(const o of s)i[this.config[o]]||(this.$emit("error",`${this.cardTitle}: "${this.config.dataset}" ${s} column "${o}" missing`),a=!1);if(!a)return;let r=i[this.config.bubble].values.map(o=>o*e);this.config.skipFirstRow&&(r=r.slice(1));let n=i[this.config.x].values||[];this.config.skipFirstRow&&(n=n.slice(1));let l=i[this.config.y].values;this.config.skipFirstRow&&(l=l.slice(1)),this.data=[{x:n,y:l,name:t,mode:"markers",type:"scatter",textinfo:"label+percent",textposition:"inside",automargin:!0,showlegend:!0,marker:{size:r}}]}}});var y=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("VuePlotly",{staticClass:"yplot",attrs:{data:t.data,layout:t.layout,options:t.options,id:t.id}})},x=[],S=m(b,y,x,!1,null,"8afb9329");const q=S.exports;export{q as default};
